<!DOCTYPE html>
<html>

<head>
  <!-- proud for contributing Vue.js -->
  <meta charset="utf-8">
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes" />

  
  <title>
    
    Connectä¸­é—´ä»¶ä½¿ç”¨æ‰‹å†Œ -
    
    å›§å…‹æ–¯
  </title>

  
<link rel="stylesheet" href="/css/pure.css">

  
<link rel="stylesheet" href="/css/style.css">


  
  <link rel="alternate" href="/atom.xml" title="å›§å…‹æ–¯" type="application/atom+xml">
  
  
  <link rel="icon" href="/favicon.ico">
  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <script>(() => { if ((new Date().getHours() + 6) % 24 < 12) document.body.classList.add('dark-mode') })()</script>

  <div class="dark-mode-helper"></div>

  <div id="wrapper">

    <div id="header">
      <h1>
        <a href="/" title="å›§å…‹æ–¯">
          å›§å…‹æ–¯
        </a>
      </h1>
      <p class="description">
        è¿™é‡Œæ˜¯å‹¾ä¸‰è‚¡å››çš„å®¶
      </p>
    </div>

    <div id="nav" class="pure-menu pure-menu-open pure-menu-horizontal">
      <ul>
        
        <li>
          <a href="/all-demos/">
            çº¿ä¸Š
          </a>
        </li>
        
        <li>
          <a href="/all-slides/">
            çº¿ä¸‹
          </a>
        </li>
        
        <li>
          <a href="/about/">
            å…³äº
          </a>
        </li>
        
        <li><a href="/archives">å½’æ¡£</li>
      </ul>
    </div>

    <div id="main"><div class="content">
  <h2>
    Connectä¸­é—´ä»¶ä½¿ç”¨æ‰‹å†Œ
  </h2>
  <p>ä»¥ä¸‹å†…å®¹å¤§å¤šè¯‘è‡ª<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/">Connectå®˜ç½‘</a> 2013-06-02</p>
<p>Connectæ˜¯åŸºäºNodeçš„ä¸­é—´ä»¶æ¡†æ¶(middleware framework)ï¼Œæä¾›è¶…è¿‡18ç§å®˜æ–¹ä¸­é—´ä»¶ä»¥åŠæ›´å¤šçš„ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code>var app = connect()
  .use(connect.logger(&apos;dev&apos;))
  .use(connect.static(&apos;public&apos;))
  .use(function(req, res)&#123;
    res.end(&apos;hello world\n&apos;);
  &#125;)
 .listen(3000);
</code></pre><p>å®‰è£…æ–¹å¼ï¼š</p>
<pre><code>$ npm install connect
</code></pre><p>ä¾æ¬¡ä»‹ç»å®˜æ–¹ä¸­é—´ä»¶</p>
<a id="more"></a>
<h3 id="1-æ—¥å¿—-logger"><a href="#1-æ—¥å¿—-logger" class="headerlink" title="1. æ—¥å¿— logger"></a>1. æ—¥å¿— logger</h3><p>æœåŠ¡å™¨è¯·æ±‚æ—¥å¿—ï¼Œæ”¯æŒè‡ªå®šä¹‰æ ¼å¼ï¼Œæ”¯æŒä¼ å…¥ <code>options</code> é€‰é¡¹å¯¹è±¡æˆ– <code>format</code> å­—ç¬¦ä¸²ã€‚</p>
<h4 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>format</code> è¡¨ç¤ºæ—¥å¿—æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œç”±å„ç§è®°å·(token)ç»„åˆè€Œæˆ</li>
<li><code>stream</code> è¡¨ç¤ºè¾“å‡ºåˆ°å“ªé‡Œã€‚é»˜è®¤æ˜¯ <code>stdout</code></li>
<li><code>buffer</code> è¡¨ç¤ºç¼“å†²çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤ä¸º 1000ms</li>
<li><code>immediate</code> æ˜¯å¦åœ¨è¯·æ±‚(request)çš„æ—¶å€™ç«‹å³å†™æ—¥å¿—ï¼Œè€Œä¸æ˜¯åœ¨å›åº”(response)çš„æ—¶å€™</li>
</ul>
<h4 id="è®°å·-Tokens"><a href="#è®°å·-Tokens" class="headerlink" title="è®°å·(Tokens)"></a>è®°å·(Tokens)</h4><ul>
<li>:req[header] (å¦‚ :req[Accept])</li>
<li>:res[header] (å¦‚ :res[Content-Length])</li>
<li>:http-versionã€:response-timeã€:remote-addrã€:dateã€:methodã€:urlã€:referrerã€:user-agentã€:status</li>
</ul>
<h4 id="é»˜è®¤çš„æ—¥å¿—æ ¼å¼-Formats"><a href="#é»˜è®¤çš„æ—¥å¿—æ ¼å¼-Formats" class="headerlink" title="é»˜è®¤çš„æ—¥å¿—æ ¼å¼(Formats)"></a>é»˜è®¤çš„æ—¥å¿—æ ¼å¼(Formats)</h4><p> <code>default</code> ã€ <code>short</code> ã€ <code>tiny</code></p>
<p>å…¶ä¸­ <code>default</code> ä»£è¡¨çš„æ ¼å¼æ˜¯ï¼š</p>
<pre><code>:remote-addr - - [:date] &quot;:method :url HTTP/:http-version&quot; :status :res[content-length] &quot;:referrer&quot; &quot;:user-agent&quot;
</code></pre><p>å¦å¤–è¿˜æœ‰ <code>dev</code> æ ¼å¼ï¼Œå¯ä»¥ç€è‰²è¾“å‡ºå“åº”çŠ¶æ€ï¼Œå¼€å‘æ—¶é€‚ç”¨ã€‚</p>
<h4 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h4><p>è®°å·å’Œæ ¼å¼éƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰æ›´å¤šçš„ï¼Œé€šè¿‡</p>
<ul>
<li><code>connect.logger.token(name, function (req, res) &#123;...&#125;)</code> å’Œ</li>
<li><code>connect.logger.format(name, stringOrFunction)</code></li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/logger.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="2-é˜²æ­¢è·¨åŸŸä¼ªé€ è¯·æ±‚-csrf"><a href="#2-é˜²æ­¢è·¨åŸŸä¼ªé€ è¯·æ±‚-csrf" class="headerlink" title="2. é˜²æ­¢è·¨åŸŸä¼ªé€ è¯·æ±‚ csrf"></a>2. é˜²æ­¢è·¨åŸŸä¼ªé€ è¯·æ±‚ csrf</h3><p>é»˜è®¤æƒ…å†µä¸‹è¯¥ä¸­é—´ä»¶ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºâ€œ_csrfâ€çš„è®°å·ï¼Œè¯¥è®°å·å¯ä»¥ä½œä¸ºè¯·æ±‚çš„çŠ¶æ€ã€è¡¨å•æäº¤çš„éšè—å±æ€§å€¼æˆ–æŸ¥è¯¢å­—ç¬¦ä¸²ç­‰ç­‰ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯ä¸ <code>req.session._csrf</code> å±æ€§è¿›è¡Œæ ¸å¯¹ã€‚å¦‚æœæ ¸å¯¹å‡ºé”™ï¼Œåˆ™ä¼šå‡ºç°403é”™è¯¯ã€‚</p>
<p>é»˜è®¤çš„ <code>value</code> å‡½æ•°ä¼šä»¥æ­¤æ ¸å¯¹ <code>bodyParser()</code> ä¸­é—´ä»¶ç”Ÿæˆçš„ <code>req.body</code> ã€ <code>query()</code> ç”Ÿæˆçš„ <code>req.query</code> ä»¥åŠåä¸ºâ€œX-CSRF-Tokenâ€çš„å¤´ä¿¡æ¯ã€‚</p>
<p>è¯¥ä¸­é—´ä»¶éœ€è¦ä¼šè¯æ”¯æŒï¼Œå› æ­¤å¿…é¡»å‡ºç°åœ¨ <code>session()</code> å’Œ <code>cookieParse()</code> ä¸­é—´ä»¶ä¹‹åã€‚</p>
<p>é»˜è®¤çš„ <code>defaultValue()</code> å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code>function defaultValue(req) &#123;
  return (req.body &amp;&amp; req.body._csrf)
    || (req.query &amp;&amp; req.query._csrf)
    || (req.headers[&apos;x-csrf-token&apos;]);
&#125;
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/csrf.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="3-å‹ç¼©-compress"><a href="#3-å‹ç¼©-compress" class="headerlink" title="3. å‹ç¼© compress"></a>3. å‹ç¼© compress</h3><p>Gzipå‹ç¼©çš„ä¸­é—´ä»¶</p>
<p>æ”¯æŒçš„æ–¹æ³•éƒ½åœ¨ <code>connect.compress.methods</code> ä¸­ï¼Œé€šè¿‡ <code>connect.compress.filter(req, res)</code> æ–¹æ³•åˆ¤æ–­æ–‡ä»¶æ˜¯å¦éœ€è¦å‹ç¼©ï¼Œé»˜è®¤å‹ç¼©Content-Typeå«jsonã€textæˆ–javascriptçš„æ–‡ä»¶ã€‚</p>
<p>æ›´é«˜çº§çš„æ“ä½œæ˜¯å¯ä»¥å°†å…·ä½“å‹ç¼©æ–¹æ³•çš„å‚æ•°é€šè¿‡optionså‚æ•°ä¼ è¿›å»ï¼š</p>
<pre><code>connect.compress(&#123;
    chunkSize: ..., // default 16*1024
    windowBits: ...,
    level: ..., // 0-9
    memLevel: ..., // 1-9
    strategy: ...
&#125;)
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/compress.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="4-HTTPåŸºç¡€è®¤è¯-basicAuth"><a href="#4-HTTPåŸºç¡€è®¤è¯-basicAuth" class="headerlink" title="4. HTTPåŸºç¡€è®¤è¯ basicAuth"></a>4. HTTPåŸºç¡€è®¤è¯ basicAuth</h3><ul>
<li>æä¾›å›è°ƒå‡½æ•° <code>connect.basicAuth(function (user, pass) &#123;...&#125;)</code> ï¼Œå¦‚æœè¿™ä¸ªå›è°ƒå‡½æ•°è¿”å› <code>true</code> ï¼Œåˆ™è·å¾—è®¿é—®æƒé™ã€‚</li>
<li>æä¾›å¼‚æ­¥çš„è°ƒç”¨æ–¹å¼ <code>connect.basicAuth(function (user, pass, callback))</code></li>
<li>ç›´æ¥æœ‰æ•ˆçš„å•ä¸€ç”¨æˆ·åå¯†ç çš„æ–¹å¼ <code>connect.basicAuth(&#39;username&#39;, &#39;password&#39;)</code></li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/basicAuth.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="5-ä¸»ä½“è§£æå™¨-Body-Parser"><a href="#5-ä¸»ä½“è§£æå™¨-Body-Parser" class="headerlink" title="5. ä¸»ä½“è§£æå™¨ Body Parser"></a>5. ä¸»ä½“è§£æå™¨ Body Parser</h3><p>å¯æ‰©å±•çš„è§£æå™¨ï¼Œå¯¹è¯·æ±‚çš„bodyè¿›è¡Œè§£æã€‚æ”¯æŒ<em>application/json</em>ã€<em>application/x-www-form-urlencoded</em>ã€<em>multipart/form-data</em></p>
<p>å…¶ç­‰åŒäºï¼š</p>
<pre><code>app.use(connect.json());
app.use(connect.urlencoded());
app.use(connect.multipart());
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/bodyParser.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="5-1-json"><a href="#5-1-json" class="headerlink" title="5.1 json"></a>5.1 json</h3><p><em>application/json</em>è§£æå™¨ï¼Œå¹¶å°†ç»“æœæ”¾è‡³ <code>req.body</code></p>
<h4 id="é€‰é¡¹-1"><a href="#é€‰é¡¹-1" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>strict</code> æ˜¯å¦ä¸¥æ ¼è§£æï¼Œå½“å€¼ä¸º <code>false</code> æ—¶ï¼Œç†è®ºä¸Š <code>JSON.parse()</code> èƒ½è§£æçš„æ•°æ®éƒ½æ˜¯è¢«å…è®¸çš„</li>
<li><code>reviver</code> ç”¨ä½œ <code>JSON.parse()</code> æ–¹æ³•çš„ç¬¬äºŒå‚æ•°</li>
<li><code>limit</code> å­—èŠ‚æ•°é™åˆ¶ï¼Œé»˜è®¤ä¸å¼€å¯</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/json.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="5-2-urlencoded"><a href="#5-2-urlencoded" class="headerlink" title="5.2 urlencoded"></a>5.2 urlencoded</h3><p><em>application/x-www-form-urlencoded</em>è§£æå™¨ï¼Œå¹¶å°†ç»“æœæ”¾è‡³ <code>req.body</code></p>
<h4 id="é€‰é¡¹-2"><a href="#é€‰é¡¹-2" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>limit</code> å­—èŠ‚æ•°é™åˆ¶ï¼Œé»˜è®¤ä¸å¼€å¯</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/urlencoded.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="5-3-multipart"><a href="#5-3-multipart" class="headerlink" title="5.3 multipart"></a>5.3 multipart</h3><p><em>multipart/form-data</em>è§£æå™¨ï¼Œå¹¶å°†ç»“æœæ”¾è‡³ <code>req.body</code> å’Œ <code>req.files</code></p>
<h4 id="é€‰é¡¹-3"><a href="#é€‰é¡¹-3" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>limit</code> å­—èŠ‚æ•°é™åˆ¶ï¼Œé»˜è®¤ä¸å¼€å¯</li>
<li><code>defer</code> å»¶æ—¶å¤„ç†å¹¶ä¸ç­‰ <code>end</code> äº‹ä»¶è§¦å‘å°±è°ƒç”¨ <code>req.form.next()</code> å±•ç¤ºå¤§è¡¨å•ã€‚è¯¥é€‰é¡¹åœ¨éœ€è¦ç»‘å®š <code>progress</code> äº‹ä»¶æ—¶å¯ç”¨ã€‚</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/multipart.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="6-è¶…æ—¶æ—¶é—´-timeout"><a href="#6-è¶…æ—¶æ—¶é—´-timeout" class="headerlink" title="6. è¶…æ—¶æ—¶é—´ timeout"></a>6. è¶…æ—¶æ—¶é—´ timeout</h3><p>ç”¨æ³•ï¼š <code>connect.timeout(ms)</code> ã€‚å¦‚æœè¯·æ±‚è¶…æ—¶åˆ™æŒ‡å‘408é”™è¯¯ã€‚</p>
<p>å¦ï¼Œ <code>req</code> å¯¹è±¡ä¼šå¤šä¸€ä¸ª <code>req.clearTimeout()</code> æ–¹æ³•ï¼Œç”¨æ¥åœ¨å¿…è¦çš„æƒ…å†µä¸‹å–æ¶ˆè®¡æ—¶ã€‚</p>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/timeout.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="7-Cookieè§£æå™¨-cookieParser"><a href="#7-Cookieè§£æå™¨-cookieParser" class="headerlink" title="7. Cookieè§£æå™¨ cookieParser"></a>7. Cookieè§£æå™¨ cookieParser</h3><p>è§£æå¤´ä¸­çš„<em>Cookie</em>å¹¶å°†ç»“æœæ”¾è‡³ <code>req.cookies</code> ã€‚ä½ è¿˜å¯ä»¥é€šè¿‡ <code>connect.cookieParser(secret)</code> ä¸­çš„ <code>secret</code> å‚æ•°å¯¹cookieè¿›è¡ŒåŠ å¯†ã€‚è¯¥å¯†ç å¯ä»¥é€šè¿‡ <code>req.secret</code> è¿›è¡Œå–å€¼ã€‚</p>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/cookieParser.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="8-ä¼šè¯-session"><a href="#8-ä¼šè¯-session" class="headerlink" title="8. ä¼šè¯ session"></a>8. ä¼šè¯ session</h3><p>è¯¦æƒ…ç•¥ã€‚</p>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/session.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="9-åŸºäºcookieçš„ä¼šè¯æ”¯æŒ-cookieSession"><a href="#9-åŸºäºcookieçš„ä¼šè¯æ”¯æŒ-cookieSession" class="headerlink" title="9. åŸºäºcookieçš„ä¼šè¯æ”¯æŒ cookieSession"></a>9. åŸºäºcookieçš„ä¼šè¯æ”¯æŒ cookieSession</h3><pre><code>connect.cookieSession(&#123; secret: &apos;tobo!&apos;, cookie: &#123; maxAge: 60 * 60 * 1000 &#125;&#125;);
</code></pre><h4 id="é€‰é¡¹-4"><a href="#é€‰é¡¹-4" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>key</code> cookieåï¼Œé»˜è®¤æ˜¯ <code>connect.sess</code></li>
<li><code>secret</code> å¯†ç </li>
<li><code>cookie</code> ä¼šè¯cookieçš„è®¾ç½®ï¼Œé»˜è®¤æ˜¯ <code>&#123; path: &#39;/&#39;, httpOnly: true, maxAge: null &#125;</code></li>
<li><code>proxy</code> ä¿¡ä»»åå‘ä»£ç†</li>
</ul>
<h4 id="æ¸…é™¤ä¼šè¯"><a href="#æ¸…é™¤ä¼šè¯" class="headerlink" title="æ¸…é™¤ä¼šè¯"></a>æ¸…é™¤ä¼šè¯</h4><pre><code>req.session = null;
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/cookieSession.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="10-æ”¯æŒä¼ªé€ HTTPæ–¹æ³•-methodOverride"><a href="#10-æ”¯æŒä¼ªé€ HTTPæ–¹æ³•-methodOverride" class="headerlink" title="10. æ”¯æŒä¼ªé€ HTTPæ–¹æ³• methodOverride"></a>10. æ”¯æŒä¼ªé€ HTTPæ–¹æ³• methodOverride</h3><p>å½“æ£€æŸ¥åˆ°æ–¹æ³•é‡è½½çš„æ—¶å€™ï¼ŒæŠŠåŸæ–¹æ³•å­˜å…¥ <code>req.originalMethod</code> ï¼Œæ£€æŸ¥çš„å­—æ®µå¯ä»¥é€šè¿‡å‚æ•° <code>key</code> è®¾ç½®ï¼Œé»˜è®¤ä¸º <code>_method</code></p>
<pre><code>connect.methodOverride(key)
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/methodOverride.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="11-å“åº”æ—¶é—´-responseTime"><a href="#11-å“åº”æ—¶é—´-responseTime" class="headerlink" title="11. å“åº”æ—¶é—´ responseTime"></a>11. å“åº”æ—¶é—´ responseTime</h3><p>è®¡ç®—å“åº”æ—¶é—´å¹¶å±•ç¤ºä¸º <code>X-Response-Time</code> å¤´</p>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/responseTime.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="12-é™æ€æœåŠ¡ç¼“å­˜-staticCache"><a href="#12-é™æ€æœåŠ¡ç¼“å­˜-staticCache" class="headerlink" title="12. é™æ€æœåŠ¡ç¼“å­˜ staticCache"></a>12. é™æ€æœåŠ¡ç¼“å­˜ staticCache</h3><p>åœ¨å†…å­˜ä¸­å»ºç«‹staticä¸­é—´ä»¶çš„ç¼“å­˜ã€‚é»˜è®¤æœ€å¤§ç¼“å­˜å¯¹è±¡ä¸º128ä¸ªï¼Œæ¯ä¸ªå¯¹è±¡çš„æœ€å¤§ä½“ç§¯æ˜¯256kï¼Œæ€»å…±å¤§çº¦32mbã€‚</p>
<h4 id="é€‰é¡¹-5"><a href="#é€‰é¡¹-5" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>maxObjects</code> æœ€å¤§ç¼“å­˜å¯¹è±¡ä¸ªæ•°ï¼Œé»˜è®¤128ä¸ª</li>
<li><code>maxLength</code> æœ€å¤§ç¼“å­˜å¯¹è±¡ä½“ç§¯ï¼Œé»˜è®¤256kb</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/staticCache.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="12-1-é™æ€æ–‡ä»¶æœåŠ¡-static"><a href="#12-1-é™æ€æ–‡ä»¶æœåŠ¡-static" class="headerlink" title="12.1 é™æ€æ–‡ä»¶æœåŠ¡ static"></a>12.1 é™æ€æ–‡ä»¶æœåŠ¡ static</h3><p>ä¸ºç»™å®šçš„ <code>root</code> è·¯å¾„æä¾›é™æ€æ–‡ä»¶æœåŠ¡ï¼Œä¾‹å¦‚</p>
<pre><code>connect.static(__dirname + &apos;/public&apos;, &#123;maxAge: 86400000&#125;)
</code></pre><h4 id="é€‰é¡¹-6"><a href="#é€‰é¡¹-6" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>maxAge</code> æµè§ˆå™¨ç¼“å­˜æ—¶é—´ï¼Œé»˜è®¤æ˜¯ <code>0</code></li>
<li><code>hidden</code> æ˜¯å¦å…è®¸è®¿é—®éšè—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ <code>false</code></li>
<li><code>redirect</code> è·¯å¾„æ˜¯ç›®å½•æ—¶æ˜¯å¦åœ¨ç»“å°¾è‡ªåŠ¨åŠ  <code>/</code> ï¼Œé»˜è®¤æ˜¯ <code>true</code></li>
</ul>
<h4 id="MIMEè¡¨"><a href="#MIMEè¡¨" class="headerlink" title="MIMEè¡¨"></a>MIMEè¡¨</h4><p>å±•ç¤ºMIMEæ¨¡å—ï¼Œå¯è¯»å†™</p>
<pre><code>connect.static.mime
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/static.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="13-ç›®å½•-directory"><a href="#13-ç›®å½•-directory" class="headerlink" title="13. ç›®å½• directory"></a>13. ç›®å½• directory</h3><p>åˆ—å‡ºç›®å½•çš„æ–‡ä»¶åˆ—è¡¨</p>
<h4 id="é€‰é¡¹-7"><a href="#é€‰é¡¹-7" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>hidden</code> æ˜¯å¦æ˜¾ç¤ºç‚¹(.)å¼€å¤´çš„æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ <code>false</code></li>
<li><code>icons</code> æ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶å›¾æ ‡ï¼Œé»˜è®¤æ˜¯ <code>false</code></li>
<li><code>filter</code> è¿‡æ»¤æ–‡ä»¶çš„å‡½æ•°ï¼Œé»˜è®¤æ˜¯ <code>false</code></li>
</ul>
<p>å›¾æ ‡æ–‡ä»¶åœ¨ <code>lib/public/icons/</code> ç›®å½•ä¸­</p>
<h4 id="å…¶å®ƒ-1"><a href="#å…¶å®ƒ-1" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h4><ul>
<li><code>connect.directory.html()</code> è¾“å‡ºhtmlæ ¼å¼çš„å†…å®¹</li>
<li><code>connect.directory.json()</code> è¾“å‡ºjsonæ ¼å¼çš„å†…å®¹</li>
<li><code>connect.directory.plain()</code> è¾“å‡ºæ–‡æœ¬æ ¼å¼çš„å†…å®¹</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/directory.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="14-è™šæ‹Ÿä¸»æœº-vhost"><a href="#14-è™šæ‹Ÿä¸»æœº-vhost" class="headerlink" title="14. è™šæ‹Ÿä¸»æœº vhost"></a>14. è™šæ‹Ÿä¸»æœº vhost</h3><p>ä¾‹å¦‚ï¼š</p>
<pre><code>connect()
  .use(connect.vhost(&apos;foo.com&apos;, fooApp))
  .use(connect.vhost(&apos;bar.com&apos;, barApp))
  .use(connect.vhost(&apos;*.com&apos;, mainApp))
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/vhost.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="15-ç«™ç‚¹å›¾æ ‡-favicon"><a href="#15-ç«™ç‚¹å›¾æ ‡-favicon" class="headerlink" title="15. ç«™ç‚¹å›¾æ ‡ favicon"></a>15. ç«™ç‚¹å›¾æ ‡ favicon</h3><p>é»˜è®¤å›¾æ ‡ä¸º <code>lib/public/favicon.ico</code> ï¼Œå¯æ›´æ”¹ï¼Œè°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code>connect.favicon(&apos;public/favicion.ico&apos;, &#123;maxAge: 86400000&#125;)
</code></pre><h4 id="é€‰é¡¹-8"><a href="#é€‰é¡¹-8" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h4><ul>
<li><code>maxAge</code> è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯1å¤©(86400000)</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/favicon.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="16-è¯·æ±‚å¤§å°é™åˆ¶-limit"><a href="#16-è¯·æ±‚å¤§å°é™åˆ¶-limit" class="headerlink" title="16. è¯·æ±‚å¤§å°é™åˆ¶ limit"></a>16. è¯·æ±‚å¤§å°é™åˆ¶ limit</h3><p>é™åˆ¶è¯·æ±‚çš„bodyå­—èŠ‚æ•°ï¼Œå¯ä¼ å…¥ä¸€ä¸ªæ•°å­—æˆ–ä»£è¡¨å®¹é‡å¤§å°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼š <code>5mb</code> ã€ <code>200kb</code> ã€ <code>1gb</code></p>
<pre><code>connect.limit(&apos;5.5mb&apos;)
</code></pre><p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/limit.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="17-æŸ¥è¯¢å­—ç¬¦ä¸²-query"><a href="#17-æŸ¥è¯¢å­—ç¬¦ä¸²-query" class="headerlink" title="17. æŸ¥è¯¢å­—ç¬¦ä¸² query"></a>17. æŸ¥è¯¢å­—ç¬¦ä¸² query</h3><p>è‡ªåŠ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œç”Ÿæˆ <code>req.query</code></p>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/query.html">ç§»æ­¥è‡³æ­¤</a></p>
<h3 id="18-é”™è¯¯å¤„ç†-errorHandler"><a href="#18-é”™è¯¯å¤„ç†-errorHandler" class="headerlink" title="18. é”™è¯¯å¤„ç† errorHandler"></a>18. é”™è¯¯å¤„ç† errorHandler</h3><p>çµæ´»çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¼€å‘ç¯å¢ƒä¸‹æä¾›å‡ºé”™ä¿¡æ¯å’Œæ ˆè¿½è¸ªï¼Œå›åº”ä¿¡æ¯æ”¯æŒçº¯æ–‡æœ¬ã€HTMLå’ŒJSON</p>
<ul>
<li>åœ¨<em>text/plain</em>çš„æƒ…å†µä¸‹å›åº”æ–‡æœ¬æ ¼å¼çš„é”™è¯¯ä¿¡æ¯</li>
<li>åœ¨<em>application/json</em>æƒ…å†µä¸‹ï¼Œå›åº” <code>&#123; &quot;error&quot;: error &#125;</code></li>
<li>åœ¨å…è®¸çš„æƒ…å†µä¸‹å›åº”HTMLé”™è¯¯ä¿¡æ¯</li>
</ul>
<p>æ›´å¤šç»†èŠ‚è¯·<a target="_blank" rel="noopener" href="https://www.senchalabs.org/connect/errorHandler.html">ç§»æ­¥è‡³æ­¤</a></p>
<p>(å®Œ)</p>

</div>

<p align="right">
  <small>
    <a href="https://github.com/Jinjiang/jinjiang.github.io/edit/dev/source/_posts/connect-middleware-manual.md" target="_blank">
      å‘æœ¬æ–‡æå‡ºä¿®æ”¹æˆ–å‹˜è¯¯å»ºè®®
    </a>
  </small>
</p>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
  const gitalk = new Gitalk({
    clientID: 'c99e23053fc1bba6a58c',
    clientSecret: '64efe1cd1438e77ae2bf8eba92b51c90d0cc2b9f',
    repo: 'jinjiang.github.io',
    owner: 'jinjiang',
    admin: ['jinjiang'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>
</div>

    <div id="footer">
      <a href="/">å›§å…‹æ–¯</a>
      
      |
      <a href="/atom.xml" title="rss_feed">RSS</a>
      
      |
      æˆ‘æ˜¯ç™¾åº¦ç»Ÿè®¡
      <script src="https://hm.baidu.com/h.js?a0a2372d4b7621d0bfe71f33c58a4bd8"></script>
      |
      æˆ‘ä¼šç¿»è„¸ <a href="#" onclick="document.body.classList.toggle('dark-mode'), event.preventDefault()" style="font-size: 1.25em;">ğŸŒšğŸŒ</a>
    </div>
  </div>

  
<script src="/js/script.js"></script>

</body>

</html>
