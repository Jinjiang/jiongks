<!DOCTYPE html>
<html>

<head>
  <!-- proud for contributing Vue.js -->
  <meta charset="utf-8">
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes" />

  
  <title>
    
    [è¯‘]æ’°å†™å¯æµ‹è¯•çš„ JavaScript -
    
    å›§å…‹æ–¯
  </title>

  
<link rel="stylesheet" href="/css/pure.css">

  
<link rel="stylesheet" href="/css/style.css">


  
  <link rel="alternate" href="/atom.xml" title="å›§å…‹æ–¯" type="application/atom+xml">
  
  
  <link rel="icon" href="/favicon.ico">
  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <script>(() => { if ((new Date().getHours() + 6) % 24 < 12) document.body.classList.add('dark-mode') })()</script>

  <div class="dark-mode-helper"></div>

  <div id="wrapper">

    <div id="header">
      <h1>
        <a href="/" title="å›§å…‹æ–¯">
          å›§å…‹æ–¯
        </a>
      </h1>
      <p class="description">
        è¿™é‡Œæ˜¯å‹¾ä¸‰è‚¡å››çš„å®¶
      </p>
    </div>

    <div id="nav" class="pure-menu pure-menu-open pure-menu-horizontal">
      <ul>
        
        <li>
          <a href="/all-demos/">
            çº¿ä¸Š
          </a>
        </li>
        
        <li>
          <a href="/all-slides/">
            çº¿ä¸‹
          </a>
        </li>
        
        <li>
          <a href="/about/">
            å…³äº
          </a>
        </li>
        
        <li><a href="/archives">å½’æ¡£</li>
      </ul>
    </div>

    <div id="main"><div class="content">
  <h2>
    [è¯‘]æ’°å†™å¯æµ‹è¯•çš„ JavaScript
  </h2>
  <p><mark>è¯‘è‡ªï¼š<a target="_blank" rel="noopener" href="http://alistapart.com/article/writing-testable-javascript">Writing Testable JavaScript - A List Apart</a></mark></p>
<p>è¿™ç¯‡æ–‡ç« ç®—æ˜¯ A List Apart ç³»åˆ—æ–‡ç« ä¸­ï¼ŒåŒ…æ‹¬æ»‘åŠ¨é—¨åœ¨å†…ï¼Œä»¤æˆ‘å°è±¡æœ€æ·±åˆ»çš„æ–‡ç« ä¹‹ä¸€ã€‚æœ€è¿‘æœ‰æ—¶é—´ç¿»è¯‘äº†ä¸€ä¸‹ï¼Œåˆ†äº«ç»™æ›´å¤šäººï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼</p>
<hr>
<p><strong>æˆ‘ä»¬å·²ç»é¢å¯¹åˆ°äº†è¿™ä¸€çª˜å¢ƒï¼šä¸€å¼€å§‹æˆ‘ä»¬å†™çš„ JavaScript åªæœ‰åŒºåŒºå‡ è¡Œä»£ç ï¼Œä½†æ˜¯å®ƒçš„ä»£ç é‡ä¸€ç›´åœ¨å¢é•¿ï¼Œæˆ‘ä»¬ä¸æ–­çš„åŠ å‚æ•°ã€åŠ æ¡ä»¶ã€‚æœ€åï¼Œç²— bug äº†â€¦â€¦ æˆ‘ä»¬æ‰ä¸å¾—ä¸æ”¶æ‹¾è¿™ä¸ªçƒ‚æ‘Šå­ã€‚</strong></p>
<p>å¦‚ä¸Šæ‰€è¿°ï¼Œä»Šå¤©çš„å®¢æˆ·ç«¯ä»£ç ç¡®å®æ‰¿è½½äº†æ›´å¤šçš„è´£ä»»ï¼Œæµè§ˆå™¨é‡Œçš„æ•´ä¸ªåº”ç”¨éƒ½è¶Šå˜è¶Šå¤æ‚ã€‚æˆ‘ä»¬å‘ç°ä¸¤ä¸ªæ˜æ˜¾çš„è¶‹åŠ¿ï¼š1ã€æˆ‘ä»¬æ²¡æ³•é€šè¿‡å•çº¯çš„é¼ æ ‡å®šä½å’Œç‚¹å‡»æ¥æ£€éªŒä»£ç æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œè‡ªåŠ¨åŒ–çš„æµ‹è¯•æ‰ä¼šçœŸæ­£è®©æˆ‘ä»¬æ”¾å¿ƒï¼›2ã€æˆ‘ä»¬ä¹Ÿè®¸åº”è¯¥åœ¨æ’°å†™ä»£ç çš„æ—¶å€™å°±è€ƒè™‘åˆ°ï¼Œè®©å®ƒå˜å¾—å¯æµ‹è¯•ã€‚</p>
<p>ç¥é©¬ï¼Ÿæˆ‘ä»¬éœ€è¦æ”¹å˜è‡ªå·±çš„ç¼–ç æ–¹å¼ï¼Ÿæ˜¯çš„ã€‚å› ä¸ºå³ä½¿æˆ‘ä»¬æ„è¯†åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¥½ï¼Œå¤§éƒ¨åˆ†äººå¯èƒ½åªæ˜¯å†™å†™é›†æˆæµ‹è¯•(integration tests)ç½¢äº†ã€‚é›†æˆæµ‹è¯•çš„ä¾§é‡ç‚¹æ˜¯è®©æ•´ä¸ªç³»ç»Ÿçš„æ¯ä¸€éƒ¨åˆ†å’Œè°å…±å­˜ï¼Œä½†æ˜¯è¿™å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬æ¯ä¸ªç‹¬ç«‹çš„<em>åŠŸèƒ½å•å…ƒ</em>è¿è½¬èµ·æ¥æ˜¯å¦éƒ½å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å¼•å…¥å•å…ƒæµ‹è¯•ã€‚æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½ç»å†ä¸€æ®µç—›è‹¦çš„<em>æ’°å†™å•å…ƒæµ‹è¯•</em>çš„è¿‡ç¨‹äº†ï¼Œä½†æœ€ç»ˆæˆ‘ä»¬èƒ½å¤Ÿ<em>æ’°å†™å¯æµ‹è¯•çš„ JavaScript</em>ã€‚</p>
<a id="more"></a>
<h3 id="å•å…ƒä¸é›†æˆï¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#å•å…ƒä¸é›†æˆï¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="å•å…ƒä¸é›†æˆï¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>å•å…ƒä¸é›†æˆï¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3><p>æ’°å†™é›†æˆæµ‹è¯•é€šå¸¸æ˜¯ç›¸å½“ç›´æ¥çš„ï¼šæˆ‘ä»¬å•çº¯çš„æ’°å†™ä»£ç ï¼Œæè¿°ç”¨æˆ·å¦‚ä½•å’Œè¿™ä¸ªåº”ç”¨è¿›è¡Œäº¤äº’ã€ä¼šå¾—åˆ°æ€æ ·çš„ç»“æœå°±å¥½ã€‚<a target="_blank" rel="noopener" href="http://docs.seleniumhq.org/">Selenium</a> æ˜¯è¿™ç±»æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ä¸­çš„ä½¼ä½¼è€…ã€‚è€Œ <a target="_blank" rel="noopener" href="https://github.com/jnicklas/capybara">Capybara</a> å¯ä»¥ä¾¿äº Ruby å’Œ Selenium å–å¾—è”ç³»ã€‚åœ¨å…¶å®ƒè¯­è¨€ä¸­ï¼Œè¿™ç±»å·¥å…·ä¹Ÿä¸¾ä¸èƒœä¸¾ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯æœç´¢åº”ç”¨çš„ä¸€éƒ¨åˆ†é›†æˆæµ‹è¯•ï¼š</p>
<pre><code>def test_search
    fill_in(&apos;q&apos;, :with =&gt; &apos;cat&apos;)
    find(&apos;.btn&apos;).click
    assert( find(&apos;#results li&apos;).has_content?(&apos;cat&apos;), &apos;Search results are shown&apos; )
    assert( page.has_no_selector?(&apos;#results li.no-results&apos;), &apos;No results is not shown&apos; )
end
</code></pre><p>é›†æˆæµ‹è¯•å¯¹ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºæ„Ÿå…´è¶£ï¼Œè€Œå•å…ƒæµ‹è¯•å¾€å¾€ä»…ä¸“æ³¨äºä¸€å°æ®µä»£ç ï¼š</p>
<blockquote>
<p>å½“æˆ‘ä¼´éšç‰¹å®šçš„è¾“å…¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘æ˜¯å¦æ”¶åˆ°äº†æˆ‘é¢„æœŸä¸­çš„ç»“æœï¼Ÿ</p>
</blockquote>
<p>æˆ‘ä»¬æŒ‰ç…§ä¼ ç»Ÿæ€è·¯æ’°å†™çš„ç¨‹åºæ˜¯å¾ˆéš¾è¿›è¡Œå•å…ƒæµ‹è¯•çš„ï¼ŒåŒæ—¶ä¹Ÿå¾ˆéš¾ç»´æŠ¤ã€è°ƒè¯•å’Œæ‰©å±•ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨æ’°å†™ä»£ç çš„æ—¶å€™å°±è€ƒè™‘åˆ°æˆ‘å°†æ¥è¦åšå•å…ƒæµ‹è¯•ï¼Œé‚£ä¹ˆè¿™æ ·çš„æ€è·¯ä¸ä»…ä¼šè®©æˆ‘ä»¬å‘ç°æµ‹è¯•ä»£ç å†™èµ·æ¥å¾ˆç›´æ¥ï¼Œä¹Ÿä¼šè®©æˆ‘ä»¬çœŸæ­£å†™å‡ºæ›´ä¼˜è´¨çš„ä»£ç ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æœç´¢åº”ç”¨çš„ä¾‹å­æ¥åšä¸ªç¤ºèŒƒï¼š</p>
<p><img src="http://alistapart.com/d/375/app.png" alt=""></p>
<p>å½“ç”¨æˆ·æœç´¢æ—¶ï¼Œè¯¥åº”ç”¨ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª XHR (Ajax è¯·æ±‚) å–å¾—ç›¸åº”çš„æœç´¢ç»“æœã€‚å¹¶å½“æœåŠ¡å™¨ä»¥ JSON æ ¼å¼è¿”å›æ•°æ®ä¹‹åï¼Œé€šè¿‡å‰ç«¯æ¨¡æ¿æŠŠç»“æœæ˜¾ç¤ºåœ¨é¡µé¢ä¸­ã€‚ç”¨æˆ·åœ¨æœç´¢ç»“æœä¸­ç‚¹â€œèµâ€ï¼Œè¿™ä¸ªäººçš„åå­—å°±ä¼šå‡ºç°åœ¨å³ä¾§çš„ç‚¹â€œèµâ€åˆ—è¡¨é‡Œã€‚</p>
<p>ä¸€ä¸ªâ€œä¼ ç»Ÿâ€çš„ JavaScript å®ç°å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<pre><code>// æ¨¡æ¿ç¼“å­˜ï¼Œç¼“å­˜çš„å†…å®¹å‡ä¸º jqXHR å¯¹è±¡
var tmplCache = &#123;&#125;;

/**
 * è½½å…¥æ¨¡æ¿
 * ä» &apos;/templates/&#123;name&#125;&apos; è½½å…¥æ¨¡æ¿ï¼Œå­˜å…¥ tmplCache
 * @param  &#123;string&#125; name æ¨¡æ¿åç§°
 * @return &#123;object&#125;      æ¨¡æ¿è¯·æ±‚çš„ jqXHR å¯¹è±¡
 */
function loadTemplate (name) &#123;
  if (!tmplCache[name]) &#123;
    tmplCache[name] = $.get(&apos;/templates/&apos; + name);
  &#125;
  return tmplCache[name];
&#125;

/**
 * é¡µé¢ä¸»è¦é€»è¾‘
 * 1. æ”¯æŒæœç´¢è¡Œä¸ºå¹¶å±•ç¤ºç»“æœ
 * 2. æ”¯æŒç‚¹â€œèµâ€ï¼Œè¢«èµè¿‡çš„äººä¼šå‡ºç°åœ¨ç‚¹â€œèµâ€åˆ—è¡¨é‡Œ
 */
$(function () &#123;

  var resultsList = $(&apos;#results&apos;);
  var liked = $(&apos;#liked&apos;);
  var pending = false; // ç”¨æ¥æ ‡è¯†ä¹‹å‰çš„æœç´¢æ˜¯å¦å°šæœªç»“æŸ

  // ç”¨æˆ·æœç´¢è¡Œä¸ºï¼Œè¡¨å•æäº¤äº‹ä»¶
  $(&apos;#searchForm&apos;).on(&apos;submit&apos;, function (e) &#123;
    // å±è”½é»˜è®¤è¡¨å•äº‹ä»¶
    e.preventDefault();

    // å¦‚æœä¹‹å‰çš„æœç´¢å°šæœªç»“æŸï¼Œåˆ™ä¸å¼€å§‹æ–°çš„æœç´¢
    if (pending) &#123; return; &#125;

    // å¾—åˆ°è¦æœç´¢çš„å…³é”®å­—
    var form = $(this);
    var query = $.trim( form.find(&apos;input[name=&quot;q&quot;]&apos;).val() );

    // å¦‚æœæœç´¢å…³é”®å­—ä¸ºç©ºåˆ™ä¸è¿›è¡Œæœç´¢
    if (!query) &#123; return; &#125;

    // å¼€å§‹æ–°çš„æœç´¢
    pending = true;

    // å‘é€ XHR
    $.ajax(&apos;/data/search.json&apos;, &#123;
      data : &#123; q: query &#125;,
      dataType : &apos;json&apos;,
      success : function (data) &#123;
        // å¾—åˆ° people-detailed æ¨¡æ¿
        loadTemplate(&apos;people-detailed.tmpl&apos;).then(function (t) &#123;
          var tmpl = _.template(t);

          // é€šè¿‡æ¨¡æ¿æ¸²æŸ“æœç´¢ç»“æœ
          resultsList.html( tmpl(&#123; people : data.results &#125;) );

          // ç»“æŸæœ¬æ¬¡æœç´¢
          pending = false;
        &#125;);
      &#125;
    &#125;);

    // åœ¨å¾—åˆ°æœåŠ¡å™¨å“åº”ä¹‹å‰ï¼Œæ¸…ç©ºæœç´¢ç»“æœï¼Œå¹¶å‡ºç°ç­‰å¾…æç¤º
    $(&apos;&lt;li&gt;&apos;, &#123;
      &apos;class&apos; : &apos;pending&apos;,
      html : &apos;Searching &amp;hellip;&apos;
    &#125;).appendTo( resultsList.empty() );
  &#125;);

  // ç»‘å®šç‚¹â€œèµâ€çš„è¡Œä¸ºï¼Œé¼ æ ‡ç‚¹å‡»äº‹ä»¶
  resultsList.on(&apos;click&apos;, &apos;.like&apos;, function (e) &#123;
    // å±è”½é»˜è®¤ç‚¹å‡»äº‹ä»¶
    e.preventDefault();

    // æ‰¾åˆ°å½“å‰äººçš„åå­—
    var name = $(this).closest(&apos;li&apos;).find(&apos;h2&apos;).text();

    // æ¸…é™¤ç‚¹â€œèµâ€åˆ—è¡¨çš„å ä½å…ƒç´ 
    liked.find(&apos;.no-results&apos;).remove();

    // åœ¨ç‚¹â€œèµâ€åˆ—è¡¨åŠ å…¥æ–°çš„é¡¹ç›®
    $(&apos;&lt;li&gt;&apos;, &#123; text: name &#125;).appendTo(liked);
  &#125;);

&#125;);
</code></pre><p>æˆ‘çš„æœ‹å‹ Adam Sontag ç§°ä¹‹ä¸º<em>â€œè‡ªå·±ç»™è‡ªå·±æŒ–å‘â€</em>çš„ä»£ç ï¼šå±•ç°ã€æ•°æ®ã€ç”¨æˆ·äº¤äº’ã€åº”ç”¨çŠ¶æ€å…¨éƒ¨åˆ†æ•£åœ¨äº†æ¯ä¸€è¡Œä»£ç é‡Œã€‚è¿™ç§ä»£ç æ˜¯å¾ˆå®¹æ˜“è¿›è¡Œé›†æˆæµ‹è¯•çš„ï¼Œä½†å‡ ä¹ä¸å¯èƒ½é’ˆå¯¹<em>åŠŸèƒ½å•å…ƒ</em>è¿›è¡Œå•ç‹¬çš„æµ‹è¯•ã€‚</p>
<p>å•å…ƒæµ‹è¯•ä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾ï¼Ÿæœ‰å››å¤§ç½ªé­ç¥¸é¦–ï¼š</p>
<ul>
<li>æ²¡æœ‰æ¸…æ™°çš„ç»“æ„ã€‚å‡ ä¹æ‰€æœ‰çš„å·¥ä½œéƒ½æ˜¯åœ¨ <code>$(document).ready()</code> å›è°ƒé‡Œè¿›è¡Œçš„ï¼Œè€Œè¿™ä¸€åˆ‡åœ¨ä¸€ä¸ªåŒ¿åå‡½æ•°é‡Œï¼Œå®ƒåœ¨æµ‹è¯•ä¸­æ— æ³•æš´éœ²å‡ºä»»ä½•æ¥å£ã€‚</li>
<li>å‡½æ•°å¤ªå¤æ‚ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¶…è¿‡äº† 10 è¡Œï¼Œæ¯”å¦‚æäº¤è¡¨å•çš„é‚£ä¸ªå‡½æ•°ï¼Œä¼°è®¡å¤§å®¶éƒ½è§‰å¾—å®ƒå¤ªå¿™äº†ï¼Œä¸€å£æ°”åšäº†å¾ˆå¤šäº‹ã€‚</li>
<li>éšè—çŠ¶æ€è¿˜æ˜¯å…±äº«çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œå› ä¸º <code>pending</code> åœ¨ä¸€ä¸ªé—­åŒ…é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰åŠæ³•æµ‹è¯•åœ¨æ¯ä¸ªæ­¥éª¤ä¸­è¿™ä¸ªçŠ¶æ€æ˜¯å¦æ­£ç¡®ã€‚</li>
<li>å¼ºè€¦åˆã€‚æ¯”å¦‚è¿™é‡Œ <code>$.ajax</code> æˆåŠŸçš„å›è°ƒå‡½æ•°ä¸åº”è¯¥ä¾èµ– DOM æ“ä½œã€‚</li>
</ul>
<h3 id="ç»„ç»‡æˆ‘ä»¬çš„ä»£ç "><a href="#ç»„ç»‡æˆ‘ä»¬çš„ä»£ç " class="headerlink" title="ç»„ç»‡æˆ‘ä»¬çš„ä»£ç "></a>ç»„ç»‡æˆ‘ä»¬çš„ä»£ç </h3><p>é¦–å½“å…¶å†²çš„æ˜¯æŠŠæˆ‘ä»¬ä»£ç çš„é€»è¾‘ç¼•ä¸€ç¼•ï¼Œæ ¹æ®èŒè´£çš„ä¸åŒæŠŠæ•´æ®µä»£ç åˆ†ä¸ºå‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>å±•ç°å’Œäº¤äº’</li>
<li>æ•°æ®ç®¡ç†å’Œä¿å­˜</li>
<li>åº”ç”¨çš„çŠ¶æ€</li>
<li>æŠŠä¸Šè¿°ä»£ç å»ºç«‹å¹¶ä¸²è¿èµ·æ¥</li>
</ul>
<p>åœ¨ä¹‹å‰çš„â€œä¼ ç»Ÿâ€å®ç°é‡Œï¼Œè¿™å››ç±»ä»£ç æ˜¯æ··åœ¨ä¸€èµ·çš„ï¼Œå‰ä¸€è¡Œæˆ‘ä»¬è¿˜åœ¨å¤„ç†ç•Œé¢å±•ç°ï¼Œåä¸¤è¡Œå°±åœ¨å’ŒæœåŠ¡å™¨é€šä¿¡äº†ã€‚</p>
<p><img src="http://alistapart.com/d/375/code-lines.png" alt=""></p>
<p>æˆ‘ä»¬ç»å¯¹å¯ä»¥å†™å‡ºé›†æˆæµ‹è¯•çš„ä»£ç ï¼Œä½†æˆ‘ä»¬åº”è¯¥å¾ˆéš¾å†™å‡ºå•å…ƒæµ‹è¯•äº†ã€‚åœ¨åŠŸèƒ½æµ‹è¯•é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åšå‡ºè¯¸å¦‚â€œå½“ç”¨æˆ·æœç´¢ä¸œè¥¿çš„æ—¶å€™ï¼Œä»–ä¼šçœ‹åˆ°ç›¸åº”çš„æœç´¢ç»“æœâ€çš„æ–­è¨€ï¼Œä½†æ˜¯æ— æ³•å†å…·ä½“ä¸‹å»äº†ã€‚å¦‚æœé‡Œé¢å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—è¿½è¸ªè¿›å»ï¼Œæ‰¾åˆ°ç¡®åˆ‡çš„å‡ºé”™ä½ç½®ã€‚è¿™æ ·çš„è¯åŠŸèƒ½æµ‹è¯•å…¶å®ä¹Ÿæ²¡å¸®ä¸Šä»€ä¹ˆå¿™ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬åæ€è‡ªå·±çš„ä»£ç ï¼Œé‚£ä¸å¦¨ä»å•å…ƒæµ‹è¯•å†™èµ·ï¼Œé€šè¿‡å•å…ƒæµ‹è¯•è¿™ä¸ªè§’åº¦ï¼Œæ›´å¥½çš„è§‚å¯Ÿï¼Œæ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚è¿™è¿›è€Œä¼šå¸®åŠ©æˆ‘ä»¬æ”¹è¿›ä»£ç ï¼Œè®©ä»£ç å˜å¾—æ›´æ˜“äºé‡ç”¨ã€æ˜“äºç»´æŠ¤ã€æ˜“äºæ‰©å±•ã€‚</p>
<p>æˆ‘ä»¬çš„æ–°ç‰ˆä»£ç éµå¾ªä¸‹é¢å‡ ä¸ªåŸåˆ™ï¼š</p>
<ul>
<li>æ ¹æ®ä¸Šè¿°å››ç±»èŒè´£ï¼Œåˆ—å‡ºæ¯ä¸ªäº’ä¸ç›¸å¹²çš„è¡Œä¸ºï¼Œå¹¶åˆ†åˆ«ç”¨ä¸€ä¸ªå¯¹è±¡æ¥è¡¨ç¤ºã€‚å¯¹è±¡ä¹‹å‰äº’ä¸ä¾èµ–ï¼Œä»¥é¿å…ä¸åŒçš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</li>
<li>ç”¨å¯é…ç½®çš„å†…å®¹ä»£æ›¿å†™æ­»çš„å†…å®¹ï¼Œä»¥é¿å…æˆ‘ä»¬ä¸ºäº†æµ‹è¯•è€Œå¤åˆ»æ•´ä¸ª HTML ç¯å¢ƒã€‚</li>
<li>ä¿æŒå¯¹è±¡æ–¹æ³•çš„ç®€å•æ˜äº†ã€‚è¿™ä¼šæŠŠæµ‹è¯•å·¥ä½œå˜å¾—ç®€å•æ˜“æ‡‚ã€‚</li>
<li>é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®æµ‹è¯•çš„éœ€è¦å¤åˆ»æ¯ä¸€æ®µä»£ç çš„å†…å®¹ã€‚</li>
</ul>
<p>ä½œä¸ºèµ·æ­¥ï¼Œæˆ‘ä»¬æœ‰å¿…è¦ææ¸…æ¥šï¼Œè¯¥å¦‚ä½•æŠŠåº”ç”¨åˆ†è§£æˆä¸åŒçš„éƒ¨åˆ†ã€‚æˆ‘ä»¬æœ‰ä¸‰å—å±•ç°å’Œäº¤äº’çš„å†…å®¹ï¼šæœç´¢æ¡†ã€æœç´¢ç»“æœå’Œç‚¹â€œèµâ€åˆ—è¡¨ã€‚</p>
<p><img src="http://alistapart.com/d/375/app-views.png" alt=""></p>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€å—å†…å®¹æ˜¯ä»æœåŠ¡å™¨è·å–æ•°æ®çš„ã€ä¸€å—å†…å®¹æ˜¯æŠŠæ‰€æœ‰çš„å†…å®¹ç²˜åˆåœ¨ä¸€èµ·çš„ã€‚</p>
<p>æˆ‘ä»¬ä»æ•´ä¸ªåº”ç”¨æœ€ç®€å•çš„ä¸€éƒ¨åˆ†å¼€å§‹å§ï¼šç‚¹â€œèµâ€åˆ—è¡¨ã€‚åœ¨åŸç‰ˆåº”ç”¨ä¸­ï¼Œè¿™éƒ¨åˆ†ä»£ç çš„èŒè´£å°±æ˜¯æ›´æ–°ç‚¹â€œèµâ€åˆ—è¡¨ï¼š</p>
<pre><code>var liked = $(&apos;#liked&apos;);
var resultsList = $(&apos;#results&apos;);

// ...

resultsList.on(&apos;click&apos;, &apos;.like&apos;, function (e) &#123;
  e.preventDefault();
  var name = $(this).closest(&apos;li&apos;).find(&apos;h2&apos;).text();
  liked.find( &apos;.no-results&apos; ).remove();
  $(&apos;&lt;li&gt;&apos;, &#123; text: name &#125;).appendTo(liked);
&#125;);
</code></pre><p>æœç´¢ç»“æœè¿™éƒ¨åˆ†æ˜¯å®Œå…¨å’Œç‚¹â€œèµâ€åˆ—è¡¨æ…åœ¨ä¸€èµ·çš„ï¼Œå¹¶ä¸”éœ€è¦å¾ˆå¤š DOM å¤„ç†ã€‚æ›´å¥½çš„æ˜“äºæµ‹è¯•çš„å†™æ³•æ˜¯åˆ›å»ºä¸€ä¸ªç‚¹â€œèµâ€åˆ—è¡¨çš„å¯¹è±¡ï¼Œå®ƒçš„èŒè´£å°±æ˜¯å°è£…ç‚¹â€œèµâ€åˆ—è¡¨çš„ DOM æ“ä½œã€‚</p>
<pre><code>var Likes = function (el) &#123;
  this.el = $(el);
  return this;
&#125;;

Likes.prototype.add = function (name) &#123;
  this.el.find(&apos;.no-results&apos;).remove();
  $(&apos;&lt;li&gt;&apos;, &#123; text: name &#125;).appendTo(this.el);
&#125;;
</code></pre><p>è¿™æ®µä»£ç æä¾›äº†åˆ›å»ºä¸€ä¸ªç‚¹â€œèµâ€åˆ—è¡¨å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚å®ƒæœ‰ <code>.add()</code> æ–¹æ³•ï¼Œå¯ä»¥åœ¨äº§ç”Ÿæ–°çš„èµçš„æ—¶å€™ä½¿ç”¨ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å†™å¾ˆå¤šæµ‹è¯•ä»£ç æ¥ä¿éšœå®ƒçš„æ­£å¸¸å·¥ä½œäº†ï¼š</p>
<pre><code>var ul;

// è®¾ç½®æµ‹è¯•çš„åˆå§‹çŠ¶æ€ï¼šç”Ÿæˆä¸€ä¸ªæœç´¢ç»“æœåˆ—è¡¨
setup(function()&#123;
  ul = $(&apos;&lt;ul&gt;&lt;li class=&quot;no-results&quot;&gt;&lt;/li&gt;&lt;/ul&gt;&apos;);
&#125;);

test(&apos;æµ‹è¯•æ„é€ å‡½æ•°&apos;, function () &#123;
  var l = new Likes(ul);
  // æ–­è¨€å¯¹è±¡å­˜åœ¨
  assert(l);
&#125;);

test(&apos;ç‚¹ä¸€ä¸ªâ€œèµâ€&apos;, function () &#123;
  var l = new Likes(ul);
  l.add(&apos;Brendan Eich&apos;);

  // æ–­è¨€åˆ—è¡¨é•¿åº¦ä¸º1
  assert.equal(ul.find(&apos;li&apos;).length, 1);
  // æ–­è¨€åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ HTML ä»£ç æ˜¯ &apos;Brendan Eich&apos;
  assert.equal(ul.find(&apos;li&apos;).first().html(), &apos;Brendan Eich&apos;);
  // æ–­è¨€å ä½å…ƒç´ å·²ç»ä¸å­˜åœ¨äº†
  assert.equal(ul.find(&apos;li.no-results&apos;).length, 0);
&#125;);
</code></pre><p>æ€ä¹ˆæ ·ï¼Ÿå¹¶ä¸éš¾å§ :-) æˆ‘ä»¬è¿™é‡Œç”¨åˆ°äº†åä¸º <a target="_blank" rel="noopener" href="http://visionmedia.github.io/mocha/">Mocha</a> çš„<em>æµ‹è¯•æ¡†æ¶</em>ï¼Œä»¥åŠåä¸º <a target="_blank" rel="noopener" href="http://chaijs.com/">Chai</a> çš„<em>æ–­è¨€åº“</em>ã€‚Mocha æä¾›äº† <code>test</code> å’Œ <code>setup</code> å‡½æ•°ï¼›è€Œ Chai æä¾›äº† <code>assert</code>ã€‚æµ‹è¯•æ¡†æ¶å’Œæ–­è¨€åº“çš„é€‰æ‹©è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å‡ºäºä»‹ç»çš„ç›®çš„ç»™å¤§å®¶å±•ç¤ºè¿™ä¸¤æ¬¾ã€‚ä½ å¯ä»¥æ‰¾åˆ°å±äºé€‚åˆè‡ªå·±çš„é¡¹ç›®â€”â€”é™¤äº† Mocha ä¹‹å¤–ï¼Œ<a target="_blank" rel="noopener" href="http://qunitjs.com/">QUnit</a> ä¹Ÿæ¯”è¾ƒæµè¡Œã€‚å¦å¤– <a target="_blank" rel="noopener" href="http://theintern.io/">Intern</a> ä¹Ÿæ˜¯ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œå®ƒè¿ç”¨äº†å¤§é‡çš„ promise æ–¹å¼ã€‚</p>
<p>æˆ‘ä»¬çš„æµ‹è¯•ä»£ç æ˜¯ä»ç‚¹â€œèµâ€åˆ—è¡¨è¿™ä¸€å®¹å™¨å¼€å§‹çš„ã€‚ç„¶åå®ƒè¿è¡Œäº†ä¸¤ä¸ªæµ‹è¯•ï¼šä¸€ä¸ªæ˜¯ç¡®å®šç‚¹â€œèµâ€åˆ—è¡¨æ˜¯å­˜åœ¨çš„ï¼›å¦ä¸€ä¸ªæ˜¯ç¡®ä¿ <code>.add()</code> æ–¹æ³•è¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚æœ‰è¿™äº›æµ‹è¯•åšåç›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¾å¿ƒé‡æ„ç‚¹â€œèµâ€åˆ—è¡¨è¿™éƒ¨åˆ†çš„ä»£ç äº†ï¼Œå³ä½¿ä»£ç è¢«ç ´åäº†ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¿¡å¿ƒæŠŠå®ƒä¿®å¤å¥½ã€‚</p>
<p>æˆ‘ä»¬æ–°åº”ç”¨çš„ä»£ç ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>var liked = new Likes(&apos;#liked&apos;); // æ–°çš„ç‚¹â€œèµâ€åˆ—è¡¨å¯¹è±¡
var resultsList = $(&apos;#results&apos;);

// ...

resultsList.on(&apos;click&apos;, &apos;.like&apos;, function (e) &#123;
  e.preventDefault();
  var name = $(this).closest(&apos;li&apos;).find(&apos;h2&apos;).text();
  liked.add(name); // æ–°çš„ç‚¹â€œèµâ€æ“ä½œçš„å°è£…
&#125;);
</code></pre><p>æœç´¢ç»“æœè¿™éƒ¨åˆ†æ¯”ç‚¹â€œèµâ€åˆ—è¡¨æ›´å¤æ‚ä¸€äº›ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿè¯¥æ‹¿å®ƒå¼€åˆ€äº†ã€‚å’Œæˆ‘ä»¬ä¸ºç‚¹â€œèµâ€åˆ—è¡¨åˆ›å»ºä¸€ä¸ª <code>.add()</code> æ–¹æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªä¸æœç´¢ç»“æœæœ‰äº¤äº’çš„æ–¹æ³•ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‚¹â€œèµâ€çš„å…¥å£ï¼Œå‘æ•´ä¸ªåº”ç”¨â€œå¹¿æ’­â€è‡ªå·±å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–â€”â€”æ¯”å¦‚æœ‰äººç‚¹äº†ä¸ªâ€œèµâ€ã€‚</p>
<pre><code>// ä¸ºæ¯ä¸€æ¡æœç´¢ç»“æœçš„ç‚¹â€œèµâ€æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
var SearchResults = function (el) &#123;
  this.el = $(el);
  this.el.on( &apos;click&apos;, &apos;.btn.like&apos;, _.bind(this._handleClick, this) );
&#125;;

// å±•ç¤ºæœç´¢ç»“æœï¼Œè·å–æ¨¡æ¿ï¼Œç„¶åæ¸²æŸ“
SearchResults.prototype.setResults = function (results) &#123;
  var templateRequest = $.get(&apos;people-detailed.tmpl&apos;);
  templateRequest.then( _.bind(this._populate, this, results) );
&#125;;

// å¤„ç†ç‚¹â€œèµâ€
SearchResults.prototype._handleClick = function (evt) &#123;
  var name = $(evt.target).closest(&apos;li.result&apos;).attr(&apos;data-name&apos;);
  $(document).trigger(&apos;like&apos;, [ name ]);
&#125;;

// å¯¹æ¨¡æ¿æ¸²æŸ“æ•°æ®çš„å°è£…
SearchResults.prototype._populate = function (results, tmpl) &#123;
  var html = _.template(tmpl, &#123; people: results &#125;);
  this.el.html(html);
&#125;;
</code></pre><p>ç°åœ¨æˆ‘ä»¬æ—§ç‰ˆåº”ç”¨ä¸­ç®¡ç†æœç´¢ç»“æœå’Œç‚¹â€œèµâ€åˆ—è¡¨ä¹‹é—´äº¤äº’çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>var liked = new Likes(&apos;#liked&apos;);
var resultsList = new SearchResults(&apos;#results&apos;);

// ...

$(document).on(&apos;like&apos;, function (evt, name) &#123;
  liked.add(name);
&#125;)
</code></pre><p>è¿™å°±æ›´ç®€å•æ›´æ¸…æ™°äº†ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡ <code>document</code> åœ¨å„ä¸ªç‹¬ç«‹çš„ç»„ä»¶ä¹‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œè€Œç»„ä»¶ä¹‹é—´æ˜¯äº’ä¸ä¾èµ–çš„ã€‚(å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨çœŸæ­£çš„åº”ç”¨å½“ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€äº›è¯¸å¦‚ <a target="_blank" rel="noopener" href="http://backbonejs.org/">Backbone</a> æˆ– <a target="_blank" rel="noopener" href="https://github.com/tildeio/rsvp.js">RSVP</a> åº“æ¥ç®¡ç†äº‹ä»¶ã€‚æˆ‘ä»¬å‡ºäºè®©ä¾‹å­å°½é‡ç®€å•çš„è€ƒè™‘ï¼Œä½¿ç”¨äº† <code>document</code> æ¥è§¦å‘äº‹ä»¶) æˆ‘ä»¬åŒæ—¶éšè—äº†å¾ˆå¤šè„æ´»ç´¯æ´»ï¼šæ¯”å¦‚åœ¨æœç´¢ç»“æœå¯¹è±¡é‡Œå¯»æ‰¾è¢«ç‚¹â€œèµâ€çš„äººï¼Œè¦æ¯”æ”¾åœ¨æ•´ä¸ªåº”ç”¨çš„ä»£ç é‡Œæ›´å¥½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å†™å‡ºä¿éšœæœç´¢ç»“æœå¯¹è±¡æ­£å¸¸å·¥ä½œçš„æµ‹è¯•ä»£ç äº†ï¼š</p>
<pre><code>var ul;
var data = [ /* å¡«å…¥å‡æ•°æ® */ ];

// ç¡®ä¿ç‚¹â€œèµâ€åˆ—è¡¨å­˜åœ¨
setup(function () &#123;
  ul = $(&apos;&lt;ul&gt;&lt;li class=&quot;no-results&quot;&gt;&lt;/li&gt;&lt;/ul&gt;&apos;);
&#125;);

test(&apos;æµ‹è¯•æ„é€ å‡½æ•°&apos;, function () &#123;
  var sr = new SearchResults(ul);
  // æ–­è¨€å¯¹è±¡å­˜åœ¨
  assert(sr);
&#125;);

test(&apos;æµ‹è¯•æ”¶åˆ°çš„æœç´¢ç»“æœ&apos;, function () &#123;
  var sr = new SearchResults(ul);
  sr.setResults(data);

  // æ–­è¨€æœç´¢ç»“æœå ä½å…ƒç´ å·²ç»ä¸å­˜åœ¨
  assert.equal(ul.find(&apos;.no-results&apos;).length, 0);
  // æ–­è¨€æœç´¢ç»“æœçš„å­å…ƒç´ ä¸ªæ•°å’Œæœç´¢ç»“æœçš„ä¸ªæ•°ç›¸åŒ
  assert.equal(ul.find(&apos;li.result&apos;).length, data.length);
  // æ–­è¨€æœç´¢ç»“æœçš„ç¬¬ä¸€ä¸ªå­å…ƒç´ çš„ &apos;data-name&apos; çš„å€¼å’Œç¬¬ä¸€ä¸ªæœç´¢ç»“æœç›¸åŒ
  assert.equal(
    ul.find(&apos;li.result&apos;).first().attr(&apos;data-name&apos;),
    data[0].name
  );
&#125;);

test(&apos;æµ‹è¯•ç‚¹â€œèµâ€æŒ‰é’®&apos;, function() &#123;
  var sr = new SearchResults(ul);
  var flag;
  var spy = function () &#123;
    flag = [].slice.call(arguments);
  &#125;;

  sr.setResults(data);
  $(document).on(&apos;like&apos;, spy);

  ul.find(&apos;li&apos;).first().find(&apos;.like.btn&apos;).click();

  // æ–­è¨€ `document` æ”¶åˆ°äº†ç‚¹â€œèµâ€çš„æ¶ˆæ¯
  assert(flag, &apos;äº‹ä»¶è¢«æ”¶åˆ°äº†&apos;);
  // æ–­è¨€ `document` æ”¶åˆ°çš„ç‚¹â€œèµâ€æ¶ˆæ¯ï¼Œå…¶ä¸­çš„åå­—æ˜¯ç¬¬ä¸€ä¸ªæœç´¢ç»“æœ
  assert.equal(flag[1], data[0].name, &apos;äº‹ä»¶é‡Œçš„æ•°æ®è¢«æ”¶åˆ°äº†&apos; );
&#125;);
</code></pre><p>å’ŒæœåŠ¡å™¨ç›´æ¥çš„äº¤äº’æ˜¯å¦å¤–ä¸€ä¸ªæœ‰è¶£çš„è¯é¢˜ã€‚åŸç‰ˆçš„ä»£ç åŒ…æ‹¬ä¸€ä¸ª <code>$.ajax()</code> çš„è¯·æ±‚ï¼Œä»¥åŠä¸€ä¸ªç›´æ¥æ“ä½œ DOM çš„å›è°ƒå‡½æ•°ï¼š</p>
<pre><code>$.ajax(&apos;/data/search.json&apos;, &#123;
  data : &#123; q: query &#125;,
  dataType : &apos;json&apos;,
  success : function( data ) &#123;
    loadTemplate(&apos;people-detailed.tmpl&apos;).then(function(t) &#123;
      var tmpl = _.template( t );
      resultsList.html( tmpl(&#123; people : data.results &#125;) );
      pending = false;
    &#125;);
  &#125;
&#125;);
</code></pre><p>åŒæ ·ï¼Œæˆ‘ä»¬å¾ˆéš¾ä¸ºè¿™æ ·çš„ä»£ç æ’°å†™æµ‹è¯•ã€‚å› ä¸ºå¾ˆå¤šä¸åŒçš„å·¥ä½œåŒæ—¶å‘ç”Ÿåœ¨è¿™ä¸€å°æ®µä»£ç ä¸­ã€‚æˆ‘ä»¬å¯ä»¥é‡æ–°ç»„ç»‡ä¸€ä¸‹æ•°æ®å¤„ç†çš„éƒ¨åˆ†ï¼š</p>
<pre><code>var SearchData = function () &#123; &#125;;

SearchData.prototype.fetch = function (query) &#123;
  var dfd;

  // å¦‚æœæœç´¢å…³é”®å­—ä¸ºç©ºï¼Œåˆ™ä¸åšä»»ä½•äº‹ï¼Œç«‹åˆ» `promise()`
  if (!query) &#123;
    dfd = $.Deferred();
    dfd.resolve([]);
    return dfd.promise();
  &#125;

  // å¦åˆ™ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚æœç´¢ç»“æœå¹¶æŠŠåœ¨å¾—åˆ°ç»“æœä¹‹åå¯¹å…¶æ•°æ®è¿›è¡ŒåŒ…è£…
  return $.ajax( &apos;/data/search.json&apos;, &#123;
    data : &#123; q: query &#125;,
    dataType : &apos;json&apos;
  &#125;).pipe(function( resp ) &#123;
    return resp.results;
  &#125;);
&#125;;
</code></pre><p>ç°åœ¨æˆ‘ä»¬æ”¹å˜äº†è·å¾—æœç´¢ç»“æœè¿™éƒ¨åˆ†çš„ä»£ç ï¼š</p>
<pre><code>var resultList = new SearchResults(&apos;#results&apos;);
var searchData = new SearchData();

// ...

searchData.fetch(query).then(resultList.setResults);
</code></pre><p>æˆ‘ä»¬å†ä¸€æ¬¡ç®€åŒ–äº†ä»£ç ï¼Œå¹¶é€šè¿‡ <code>SearchData</code> å¯¹è±¡æŠ›å¼ƒäº†ä¹‹å‰åº”ç”¨ç¨‹åºä¸»å‡½æ•°é‡Œæ‚ä¹±çš„ä»£ç ã€‚åŒæ—¶æˆ‘ä»¬å·²ç»è®©æœç´¢æ¥å£å˜å¾—å¯æµ‹è¯•äº†ï¼Œå°½ç®¡ç°åœ¨å’ŒæœåŠ¡å™¨é€šä¿¡è¿™é‡Œè¿˜æœ‰äº‹æƒ…è¦åšã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬ä¸æ˜¯çœŸçš„è¦è·ŸæœåŠ¡å™¨é€šä¿¡â€”â€”ä¸ç„¶è¿™åˆå˜æˆé›†æˆæµ‹è¯•äº†ï¼šè¯¸å¦‚æˆ‘ä»¬æ˜¯æœ‰è´£ä»»æ„Ÿçš„å¼€å‘è€…ï¼Œæˆ‘ä»¬å·²ç»ç¡®ä¿æœåŠ¡å™¨ä¸€å®šä¸ä¼šçŠ¯é”™ç­‰ç­‰ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿä¸ºäº†æ›¿ä»£è¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬åº”è¯¥â€œmockâ€(ä¼ªé€ ) ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚<a target="_blank" rel="noopener" href="http://sinonjs.org/">Sinon</a> è¿™ä¸ªåº“å°±å¯ä»¥åšè¿™ä»¶äº‹ã€‚ç¬¬äºŒä¸ªéšœç¢æ˜¯æˆ‘ä»¬çš„æµ‹è¯•åº”è¯¥è¦†ç›–éç†æƒ³ç¯å¢ƒï¼Œæ¯”å¦‚å…³é”®å­—ä¸ºç©ºã€‚</p>
<pre><code>test(&apos;æµ‹è¯•æ„é€ å‡½æ•°&apos;, function () &#123;
  var sd = new SearchData();
  assert(sd);
&#125;);

suite(&apos;å–æ•°æ®&apos;, function () &#123;
  var xhr, requests;

  setup(function () &#123;
    requests = [];
    xhr = sinon.useFakeXMLHttpRequest();
    xhr.onCreate = function (req) &#123;
      requests.push(req);
    &#125;;
  &#125;);

  teardown(function () &#123;
    xhr.restore();
  &#125;);

  test(&apos;é€šè¿‡æ­£ç¡®çš„ URL è·å–æ•°æ®&apos;, function () &#123;
    var sd = new SearchData();
    sd.fetch(&apos;cat&apos;);

    assert.equal(requests[0].url, &apos;/data/search.json?q=cat&apos;);
  &#125;);

  test(&apos;è¿”å›ä¸€ä¸ª promise&apos;, function () &#123;
    var sd = new SearchData();
    var req = sd.fetch(&apos;cat&apos;);

    assert.isFunction(req.then);
  &#125;);

  test(&apos;å¦‚æœå…³é”®å­—ä¸ºç©ºåˆ™ä¸æŸ¥è¯¢&apos;, function () &#123;
    var sd = new SearchData();
    var req = sd.fetch();
    assert.equal(requests.length, 0);
  &#125;);

  test(&apos;å¦‚æœå…³é”®å­—ä¸ºç©ºä¹Ÿä¼šæœ‰ promise&apos;, function () &#123;
    var sd = new SearchData();
    var req = sd.fetch();

    assert.isFunction( req.then );
  &#125;);

  test(&apos;å…³é”®å­—ä¸ºç©ºçš„ promise ä¼šè¿”å›ä¸€ä¸ªç©ºæ•°ç»„&apos;, function () &#123;
    var sd = new SearchData();
    var req = sd.fetch();
    var spy = sinon.spy();

    req.then(spy);

    assert.deepEqual(spy.args[0][0], []);
  &#125;);

  test(&apos;è¿”å›ä¸æœç´¢ç»“æœç›¸å¯¹åº”çš„å¯¹è±¡&apos;, function () &#123;
    var sd = new SearchData();
    var req = sd.fetch(&apos;cat&apos;);
    var spy = sinon.spy();

    requests[0].respond(
      200, &#123; &apos;Content-type&apos;: &apos;text/json&apos; &#125;,
      JSON.stringify(&#123; results: [ 1, 2, 3 ] &#125;)
    );

    req.then(spy);

    assert.deepEqual(spy.args[0][0], [ 1, 2, 3 ]);
  &#125;);
&#125;);
</code></pre><p>å‡ºäºç¯‡å¹…çš„è€ƒè™‘ï¼Œè¿™é‡Œå¯¹æœç´¢æ¡†çš„é‡æ„åŠå…¶ç›¸å…³çš„å•å…ƒæµ‹è¯•å°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚å®Œæ•´çš„ä»£ç å¯ä»¥<a target="_blank" rel="noopener" href="https://github.com/rmurphey/testable-javascript">ç§»æ­¥è‡³æ­¤</a>æŸ¥é˜…ã€‚</p>
<p>å½“æˆ‘ä»¬æŒ‰ç…§å¯æµ‹è¯•çš„ JavaScript çš„æ€è·¯é‡æ„ä»£ç ä¹‹åï¼Œæˆ‘ä»¬æœ€åç”¨ä¸‹é¢è¿™æ®µä»£ç å¼€å¯ç¨‹åºï¼š</p>
<pre><code>$(function() &#123;
  var pending = false;

  var searchForm = new SearchForm(&apos;#searchForm&apos;);
  var searchResults = new SearchResults(&apos;#results&apos;);
  var likes = new Likes(&apos;#liked&apos;);
  var searchData = new SearchData();

  $(document).on(&apos;search&apos;, function (event, query) &#123;
    if (pending) &#123; return; &#125;

    pending = true;

    searchData.fetch(query).then(function (results) &#123;
      searchResults.setResults(results);
      pending = false;
    &#125;);

    searchResults.pending();
  &#125;);

  $(document).on(&apos;like&apos;, function (evt, name) &#123;
    likes.add(name);
  &#125;);
&#125;);
</code></pre><p>æ¯”å¹²å‡€æ•´æ´çš„ä»£ç æ›´é‡è¦çš„ï¼Œæ˜¯æˆ‘ä»¬çš„ä»£ç æ‹¥æœ‰äº†æ›´å¥å£®çš„æµ‹è¯•åŸºç¡€ä½œä¸ºåç›¾ã€‚è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒçš„é‡æ„ä»»æ„éƒ¨åˆ†çš„ä»£ç è€Œä¸å¿…æ‹…å¿ƒç¨‹åºé­åˆ°ç ´åã€‚æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­ä¸ºæ–°åŠŸèƒ½æ’°å†™æ–°çš„æµ‹è¯•ä»£ç ï¼Œå¹¶ç¡®ä¿æ–°çš„ç¨‹åºå¯ä»¥é€šè¿‡æ‰€æœ‰çš„æµ‹è¯•ã€‚</p>
<h3 id="æµ‹è¯•ä¼šåœ¨å®è§‚ä¸Šè®©ä½ å˜è½»æ¾"><a href="#æµ‹è¯•ä¼šåœ¨å®è§‚ä¸Šè®©ä½ å˜è½»æ¾" class="headerlink" title="æµ‹è¯•ä¼šåœ¨å®è§‚ä¸Šè®©ä½ å˜è½»æ¾"></a>æµ‹è¯•ä¼šåœ¨å®è§‚ä¸Šè®©ä½ å˜è½»æ¾</h3><p>çœ‹å®Œè¿™äº›çš„é•¿ç¯‡å¤§è®ºä½ ä¸€å®šä¼šè¯´ï¼šâ€œçº³å°¼ï¼Ÿæˆ‘å¤šå†™äº†è¿™ä¹ˆå¤šä»£ç ï¼Œç»“æœè¿˜æ˜¯åšäº†è¿™ä¹ˆä¸€ç‚¹äº‹æƒ…ï¼Ÿâ€</p>
<p>å…³é”®åœ¨äºï¼Œä½ åšçš„ä¸œè¥¿æ—©æ™šè¦æ”¾åˆ°ç½‘ä¸Šçš„ã€‚åŒæ ·æ˜¯èŠ±æ—¶é—´è§£å†³é—®é¢˜ï¼Œä½ ä¼šé€‰æ‹©åœ¨æµè§ˆå™¨é‡Œç‚¹æ¥ç‚¹å»ï¼Ÿè¿˜æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿè¿˜æ˜¯ç›´æ¥åœ¨çº¿ä¸Šè®©ä½ çš„ç”¨æˆ·åšä½ çš„å°ç™½é¼ ï¼Ÿæ— è®ºä½ å†™äº†å¤šå°‘æµ‹è¯•ï¼Œä½ å†™å¥½ä»£ç ï¼Œåˆ«äººä¸€ç”¨ï¼Œå¤šå°‘ä¼šå‘ç°ç‚¹ bugã€‚</p>
<p>è‡³äºæµ‹è¯•ï¼Œå®ƒå¯èƒ½ä¼šèŠ±æ‰ä½ ä¸€äº›é¢å¤–çš„æ—¶é—´ï¼Œä½†æ˜¯å®ƒåˆ°æœ€åçœŸçš„æ˜¯ä¸ºä½ çœä¸‹äº†æ—¶é—´ã€‚å†™æµ‹è¯•ä»£ç æµ‹å‡ºä¸€ä¸ªé—®é¢˜ï¼Œæ€»æ¯”ä½ å‘å¸ƒåˆ°çº¿ä¸Šä¹‹åæ‰å‘ç°æœ‰é—®é¢˜è¦å¥½ã€‚å¦‚æœæœ‰ä¸€ä¸ªç³»ç»Ÿèƒ½è®©ä½ æ„è¯†åˆ°å®ƒçœŸçš„èƒ½é¿å…ä¸€ä¸ª bug çš„æµå‡ºï¼Œä½ ä¸€å®šä¼šå¿ƒå­˜æ„Ÿæ¿€ã€‚</p>
<h3 id="é¢å¤–çš„èµ„æº"><a href="#é¢å¤–çš„èµ„æº" class="headerlink" title="é¢å¤–çš„èµ„æº"></a>é¢å¤–çš„èµ„æº</h3><p>è¿™ç¯‡æ–‡ç« åªèƒ½ç®—æ˜¯ JavaScript æµ‹è¯•çš„ä¸€ç‚¹çš®æ¯›ï¼Œä½†æ˜¯å¦‚æœä½ å¯¹æ­¤æŠ±æœ‰å…´è¶£ï¼Œé‚£ä¹ˆå¯ä»¥ç»§ç»­ç§»æ­¥è‡³ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://lanyrd.com/2012/full-frontal/sztqh/">å¹»ç¯æ¼”ç¤º</a> 2012 Full Frontal conference in Brighton, UK</li>
<li><a target="_blank" rel="noopener" href="http://gruntjs.com/">Grunt</a> ä¸€ä¸ªå¯ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ç­‰è¯¸å¤šäº‹æƒ…çš„å·¥å…·</li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.com/dp/0321683919/">æµ‹è¯•é©±åŠ¨çš„ JavaScript å¼€å‘</a> åŠå…¶ <a target="_blank" rel="noopener" href="https://www.amazon.cn/dp/B0077KA3J4/">ä¸­æ–‡ç‰ˆ</a></li>
</ul>

</div>

<p align="right">
  <small>
    <a href="https://github.com/Jinjiang/jinjiang.github.io/edit/dev/source/_posts/writing-testable-javascript.md" target="_blank">
      å‘æœ¬æ–‡æå‡ºä¿®æ”¹æˆ–å‹˜è¯¯å»ºè®®
    </a>
  </small>
</p>



<div id="comments">
  <h2>æ—©æœŸè¯„è®º</h2>
  <ul>
  
    <li id="comment-71478" style="margin-left: 0em;">
      <p>
        <strong>
        <a href="http://blog.csdn.net/jasondu264" target="_blank" title="ä¼Ÿ">ä¼Ÿ</a>
        
        </strong>
        <small>2014/10/27 12:20:20</small></p>
      å¤ªå¥½äº†ï¼Œç»ˆäºæ‰¾åˆ°ä¸€ç¯‡è¯¦ç»†å†™æ€ä¹ˆå¼€å‘å¯æµ‹è¯•ä»£ç äº†ï¼Œè°¢è°¢åšä¸»
    </li>
  
    <li id="comment-74480" style="margin-left: 0em;">
      <p>
        <strong>
        è¾‰
        
        </strong>
        <small>2014/11/13 12:07:12</small></p>
      èµä¸€ä¸ªï¼Œæ¥¼ä¸»å†™å¾—å¾ˆå¥½å•Š
    </li>
  
    <li id="comment-87690" style="margin-left: 0em;">
      <p>
        <strong>
        <a href="http://ttour.sinaapp.com/posts/9861/%e6%92%b0%e5%86%99%e5%8f%af%e6%b5%8b%e8%af%95%e7%9a%84-javascript.html" target="_blank" title="æ’°å†™å¯æµ‹è¯•çš„ ja&lt;x&gt;vasc&lt;x&gt;ript - ja&lt;x&gt;vasc&lt;x&gt;ript - å—…æ¢å®äº‹">æ’°å†™å¯æµ‹è¯•çš„ ja&lt;x&gt;vasc&lt;x&gt;ript - ja&lt;x&gt;vasc&lt;x&gt;ript - å—…æ¢å®äº‹</a>
        
        </strong>
        <small>2015/01/19 03:01:19</small></p>
      [...]è½¬è‡ª å‹¾ä¸‰è‚¡å›› &#8211; æ’°å†™å¯æµ‹è¯•çš„ JavaScript[...]
    </li>
  
    <li id="comment-88092" style="margin-left: 0em;">
      <p>
        <strong>
        <a href="http://top.css88.com/archives/602" target="_blank" title="æ’°å†™å¯æµ‹è¯•çš„ ja&lt;x&gt;vasc&lt;x&gt;ript R11; å›§å…‹æ–¯ | å‰ç«¯å¤´æ¡">æ’°å†™å¯æµ‹è¯•çš„ ja&lt;x&gt;vasc&lt;x&gt;ript R11; å›§å…‹æ–¯ | å‰ç«¯å¤´æ¡</a>
        
        </strong>
        <small>2015/01/22 11:09:22</small></p>
      [...]é˜…è¯»è¯¦æƒ… -&gt; æ’°å†™å¯æµ‹è¯•çš„ JavaScript &#8211; å›§å…‹æ–¯.[...]
    </li>
  
    <li id="comment-92125" style="margin-left: 0em;">
      <p>
        <strong>
        <a href="http://hao.jser.com/archive/4816/" target="_blank" title="æ’°å†™å¯æµ‹è¯•çš„ ja&lt;x&gt;vasc&lt;x&gt;ript R12; å¥½JSER">æ’°å†™å¯æµ‹è¯•çš„ ja&lt;x&gt;vasc&lt;x&gt;ript R12; å¥½JSER</a>
        
        </strong>
        <small>2015/03/27 02:45:26</small></p>
      [...]è½¬è‡ª å‹¾ä¸‰è‚¡å›› &#8211; æ’°å†™å¯æµ‹è¯•çš„ JavaScript[...]
    </li>
  
  </ul>
</div>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
  const gitalk = new Gitalk({
    clientID: 'c99e23053fc1bba6a58c',
    clientSecret: '64efe1cd1438e77ae2bf8eba92b51c90d0cc2b9f',
    repo: 'jinjiang.github.io',
    owner: 'jinjiang',
    admin: ['jinjiang'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>
</div>

    <div id="footer">
      <a href="/">å›§å…‹æ–¯</a>
      
      |
      <a href="/atom.xml" title="rss_feed">RSS</a>
      
      |
      æˆ‘æ˜¯ç™¾åº¦ç»Ÿè®¡
      <script src="https://hm.baidu.com/h.js?a0a2372d4b7621d0bfe71f33c58a4bd8"></script>
      |
      æˆ‘ä¼šç¿»è„¸ <a href="#" onclick="document.body.classList.toggle('dark-mode'), event.preventDefault()" style="font-size: 1.25em;">ğŸŒšğŸŒ</a>
    </div>
  </div>

  
<script src="/js/script.js"></script>

</body>

</html>
