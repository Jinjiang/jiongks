<!DOCTYPE html>
<html>

<head>
  <!-- proud for contributing Vue.js -->
  <meta charset="utf-8">
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes" />

  
  <title>
    
    记实践 CSS 3 中几个 background-* 属性时的陷阱一则 -
    
    囧克斯
  </title>

  
<link rel="stylesheet" href="/css/pure.css">

  
<link rel="stylesheet" href="/css/style.css">


  
  <link rel="alternate" href="/atom.xml" title="囧克斯" type="application/atom+xml">
  
  
  <link rel="icon" href="/favicon.ico">
  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <script>(() => { if ((new Date().getHours() + 6) % 24 < 12) document.body.classList.add('dark-mode') })()</script>

  <div class="dark-mode-helper"></div>

  <div id="wrapper">

    <div id="header">
      <h1>
        <a href="/" title="囧克斯">
          囧克斯
        </a>
      </h1>
      <p class="description">
        这里是勾三股四的家
      </p>
    </div>

    <div id="nav" class="pure-menu pure-menu-open pure-menu-horizontal">
      <ul>
        
        <li>
          <a href="/all-demos/">
            线上
          </a>
        </li>
        
        <li>
          <a href="/all-slides/">
            线下
          </a>
        </li>
        
        <li>
          <a href="/about/">
            关于
          </a>
        </li>
        
        <li><a href="/archives">归档</li>
      </ul>
    </div>

    <div id="main"><div class="content">
  <h2>
    记实践 CSS 3 中几个 background-* 属性时的陷阱一则
  </h2>
  
<p><mark>本文摘自 勾三股四 更早时期的 <a target="_blank" rel="noopener" href="http://bulaoge.net/?g3g4">不老歌</a> 博客。</mark></p>

<a id="more"></a>
<p>发现最近自己的CSS编码能力有生疏的迹象……<br />
今天犯了一个非常低级的错误<br />
<br />
在此还原一下状况：<br />
<br />
设置一个盒子的样式，包括背景颜色、背景图片、图片位置、还有边框，在:hover时还有一些变化，比如边框会变亮变粗。<br />
<br />
一开始写好的代码，简化一下大概是这样的：<br />

<pre>
li {
    background: #999;
    border: 1px #333 solid;
    padding: 0.5em;
    -*-box-sizing: border-box;
}
li:hover {
    background: #ccc;
    border-width: 3px;
}
li.classA {
    background-image: url(images/classA-bg.png);
}
</pre>

一切正常，跟预想的效果是一样的<br />
后来我注意到一个细节，当:hover之后边框变粗了，背景图片也相应的向右下方错位了2个像素。为了不想让背景图片错位，我想到了一个办法：就是利用CSS3中的background-origin属性对背景图片的起始坐标改为边框外顶点，这样边框的宽度就不会对背景图片的位置构成影响了。<br />
于是代码变成了这个样子：<br />

<pre>
li {
    background: #999;
    border: 1px #333 solid;
    padding: 0.5em;
    -*-box-sizing: border-box;
    <strong>-*-background-origin: border-box;</strong>
}
</pre>

但是发现这一改动没有“生效”，背景图片依然会错位。<br />
经过简单的调试，我很快发现了自己的低级失误，就是在设置:hover的背景颜色样式时，没有使用background-color而是background这个缩写：<br />

<pre>
li:hover {
    <strong>background: #ccc;</strong>
    border-width: 3px;
}
</pre>

它的出现使得li中的background-origin被覆盖为了默认值(即padding-box)。当这一属性不被修改时，只有background-image被覆盖，但li.classA刚好再次覆盖了背景图片的值，所以这一问题在当时被掩盖了，可只要稍微修改一下background-repeat、background-position、background-clip、background-origin等属性，问题就立刻被暴露了出来。<br />
<br />
所以，在处理伪类等动态改变的样式时，如果涉及属性值的覆盖，尽量不要使用简写的属性值进行覆盖，因为很容易“伤及无辜”。<br />
之前在处理background这类CSS属性的时候，无法就是颜色和图片，所以能否使用简写很好判断，一不小心写错了也很好辨别并更正。随着CSS属性越来越灵活，功能越来越多，现在一不小心写错代码，就需要判断更多的环节去排查。所以CSS属性的简写写法也不是在所有的地方都推荐使用的。<br />
<br />
最后总结一下吧：在动态修饰样式时，需要慎用简写，避免“伤及无辜”，同时注意CSS3带来的更多考量。<br />
<br />
附：<a href="http://www.css3.info/preview/background-origin-and-background-clip/" target="_blank">background-origin和background-clip这两个CSS3属性的简介</a></p>

</div>

<p align="right">
  <small>
    <a href="https://github.com/Jinjiang/jinjiang.github.io/edit/dev/source/_posts/2011-10-26.md" target="_blank">
      向本文提出修改或勘误建议
    </a>
  </small>
</p>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
  const gitalk = new Gitalk({
    clientID: 'c99e23053fc1bba6a58c',
    clientSecret: '64efe1cd1438e77ae2bf8eba92b51c90d0cc2b9f',
    repo: 'jinjiang.github.io',
    owner: 'jinjiang',
    admin: ['jinjiang'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>
</div>

    <div id="footer">
      <a href="/">囧克斯</a>
      
      |
      <a href="/atom.xml" title="rss_feed">RSS</a>
      
      |
      我是百度统计
      <script src="https://hm.baidu.com/h.js?a0a2372d4b7621d0bfe71f33c58a4bd8"></script>
      |
      我会翻脸 <a href="#" onclick="document.body.classList.toggle('dark-mode'), event.preventDefault()" style="font-size: 1.25em;">🌚🌝</a>
    </div>
  </div>

  
<script src="/js/script.js"></script>

</body>

</html>
