<!DOCTYPE html>
<html>

<head>
  <!-- proud for contributing Vue.js -->
  <meta charset="utf-8">
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes" />

  
  <title>
    
    HTML5ä¸­çš„æ–‡ä»¶å¤„ç† ä¹‹ File Writer API -
    
    å›§å…‹æ–¯
  </title>

  
<link rel="stylesheet" href="/css/pure.css">

  
<link rel="stylesheet" href="/css/style.css">


  
  <link rel="alternate" href="/atom.xml" title="å›§å…‹æ–¯" type="application/atom+xml">
  
  
  <link rel="icon" href="/favicon.ico">
  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <script>(() => { if ((new Date().getHours() + 6) % 24 < 12) document.body.classList.add('dark-mode') })()</script>

  <div class="dark-mode-helper"></div>

  <div id="wrapper">

    <div id="header">
      <h1>
        <a href="/" title="å›§å…‹æ–¯">
          å›§å…‹æ–¯
        </a>
      </h1>
      <p class="description">
        è¿™é‡Œæ˜¯å‹¾ä¸‰è‚¡å››çš„å®¶
      </p>
    </div>

    <div id="nav" class="pure-menu pure-menu-open pure-menu-horizontal">
      <ul>
        
        <li>
          <a href="/all-demos/">
            çº¿ä¸Š
          </a>
        </li>
        
        <li>
          <a href="/all-slides/">
            çº¿ä¸‹
          </a>
        </li>
        
        <li>
          <a href="/about/">
            å…³äº
          </a>
        </li>
        
        <li><a href="/archives">å½’æ¡£</li>
      </ul>
    </div>

    <div id="main"><div class="content">
  <h2>
    HTML5ä¸­çš„æ–‡ä»¶å¤„ç† ä¹‹ File Writer API
  </h2>
  
<p><mark>æœ¬æ–‡æ‘˜è‡ª å‹¾ä¸‰è‚¡å›› æ›´æ—©æ—¶æœŸçš„ <a target="_blank" rel="noopener" href="http://bulaoge.net/?g3g4">ä¸è€æ­Œ</a> åšå®¢ã€‚</mark></p>

<a id="more"></a>
<p>è¿™é‡Œæ˜¯ä»‹ç»HTML5æ–‡ä»¶å¤„ç†çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œä¹‹å‰å·²ç»ä»‹ç»è¿‡äº†åŸºç¡€çš„<a href="http://bulaoge.net/topic.blg?dmn=g3g4&tid=2344378" target="_blank">FileAPI</a>ï¼Œæ¥ä¸‹æ¥æ˜¯å¦‚ä½•é€šè¿‡JSåˆ›é€ æ–‡ä»¶çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º<a href="http://www.w3.org/TR/file-writer-api/" target="_blank">FileWriterAPI</a>ã€‚<br />
<br />
éœ€è¦æå‰è§£é‡Šçš„æ˜¯ï¼ŒFileWriterAPIä¸æ˜¯ä¸€ä¸ªå¯ä»¥â€œç‹¬ç«‹â€å­˜åœ¨çš„è§„èŒƒï¼Œå®ƒå¼ºçƒˆçš„ä¾èµ–äºFileAPIå’Œå³å°†ä»‹ç»çš„FileSystemAPIã€‚FileAPIæ˜¯æœ€åŸºç¡€çš„æ¥å£è¿™æ¯‹åº¸ç½®ç–‘ï¼Œè€Œä¹‹æ‰€ä»¥å…ˆäºFileSystemAPIä»‹ç»FileWriterAPIï¼Œæ˜¯å› ä¸ºFileSystemAPIæ˜¯ä¸€å¥—æ›´åºå¤§çš„æ¥å£è®¾è®¡é›†åˆï¼ŒFileWriterAPIç›¸æ¯”ä¹‹ä¸‹ç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç®—ä½œæ˜¯FileSystemAPIä¹Ÿç”¨å¾—åˆ°çš„ä¸€éƒ¨åˆ†åŸºç¡€ï¼Œæå‰ä»‹ç»ç»™å¤§å®¶ã€‚<br />
<br />
<br />
<strong>æ€»è§ˆ</strong><br />
<br />
è¿™éƒ¨åˆ†ä¸€å…±æœ‰ä¸‰å¤§æ¥å£ï¼š<br />
* <code>BlobBuilder</code>æ¥å£ï¼šåˆ›å»º<code>Blob</code><br />
* <code>FileSaver</code>æ¥å£ï¼šæä¾›ä¸€äº›åˆ—æ–¹æ³•å’Œäº‹ä»¶ç›‘å¬æ–¹å¼ï¼Œä»£è¡¨ä¸€ä¸ªä¿å­˜æ–‡ä»¶çš„è¿‡ç¨‹<br />
* <code>FileWriter</code>æ¥å£ï¼šæ˜¯ä»<code>FileSaver</code>æ‰©å±•æ¥çš„ï¼Œæä¾›æ›´ä¸°å¯Œçš„è¾“å‡ºé€‰æ‹©<br />
<br />
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>FileSaver</code>å’Œ<code>FileWriter</code>æ˜¯ä¸èƒ½é€šè¿‡æ¥å£æŒ‡å®šè¦ä¿å­˜æˆ–è¦å†™å…¥çš„æ–‡ä»¶çš„ï¼Œå®ƒä»¬éƒ½æ˜¯å¯¹è±¡åˆ›å»ºæ—¶å°±å·²ç»ç¡®å®šçš„å¹¶ä¸”ä¸å¯æ›´æ”¹ã€‚åŒæ—¶<code>FileSaver</code>æ›´æ˜¯ä¸æä¾›æ§åˆ¶å†™å…¥ä»€ä¹ˆå†…å®¹çš„æ¥å£ï¼Œè¦å†™å…¥çš„å†…å®¹ä¹Ÿæ˜¯å¯¹è±¡åˆ›å»ºæ—¶å°±å·²ç»ç¡®å®šçš„å¹¶ä¸”ä¸å¯æ›´æ”¹çš„ï¼›è€Œ<code>FileWriter</code>å¯ä»¥é€šè¿‡æ¥å£æ§åˆ¶è¦å†™å…¥çš„å†…å®¹ã€‚<br />
<br />
<br />
<strong>æ¥å£æè¿°</strong><br />
<br />
åŒæ ·çš„ï¼Œè¿™3ä¸ªæ¥å£å…¶å®å¹¶ä¸å¤æ‚ï¼Œä¹Ÿå¾ˆå¥½ç†è§£(åŒæ ·çš„ï¼Œæ¥å£ä¸­çš„â€œ<code>#Foo</code>â€è¡¨ç¤ºä»»æ„<code>Foo</code>ç±»å‹çš„å¯¹è±¡)ï¼š<br />
<br />
<strong><code>BlobBuilder</code>æ¥å£</strong><br />
<pre>#BlobBuilder.<strong>getBlob([contentType])</strong> // è¿”å›ç›®å‰å·²æ”¾å…¥çš„æ‰€æœ‰Blobæ•°æ®æ„æˆçš„å¯¹è±¡<br>#BlobBuilder.<strong>append(text[, contentType])</strong> // æ”¾å…¥æ–‡æœ¬æ•°æ®<br>#BlobBuilder.<strong>append(data)</strong> // æ”¾å…¥æ•°æ®(Blobæˆ–ArrayBugger)</pre><br />
<strong><code>FileSaver</code>æ¥å£</strong><br />
<pre>#FileSaver.<strong>abort()</strong> // ä¸­æ–­ä¿å­˜æ“ä½œ<br>#FileSaver.<strong>readyState</strong> // ä¿å­˜å·¥ä½œçš„çŠ¶æ€(DONEã€INITã€WRITING)<br>#FileSaver.error // æœ€åä¸€æ¬¡å‡ºé”™çš„é”™è¯¯ä¿¡æ¯<br>#FileSaver.onwritestart // å†™å…¥æ“ä½œå¼€å§‹æ—¶è§¦å‘<br>#FileSaver.onwrite // å†™å…¥æ“ä½œæˆåŠŸæ—¶è§¦å‘<br>#FileSaver.onwriteend // å†™å…¥æ“ä½œå®Œæˆæ—¶è§¦å‘(ä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥)<br>#FileSaver.onprogress // å†™å…¥æ“ä½œè¿‡ç¨‹ä¸­è§¦å‘<br>#FileSaver.onabort // å†™å…¥æ“ä½œè¢«ä¸­æ–­æ—¶è§¦å‘<br>#FileSaver.onerror // å†™å…¥æ“ä½œå¤±è´¥æ—¶è§¦å‘</pre><br />
<strong><code>FileWriter</code>æ¥å£</strong><br />
<pre>#FileWriter.<strong>position</strong> // å½“å‰å†™å…¥æ“ä½œæ‰€å¤„çš„ä½ç½®<br>#FileWriter.<strong>length</strong> // æ–‡ä»¶é•¿åº¦(æˆ–åœ¨æ— æƒè¯»å–æ–‡ä»¶ä¿¡æ¯çš„æƒ…å†µä¸‹è¿”å›å·²å†™å…¥çš„é•¿åº¦)<br>#FileWriter.<strong>write(blob)</strong> // åœ¨positionå¤„å†™å…¥blobæ•°æ®<br>#FileWriter.<strong>seek(offset)</strong> // è®¾ç½®positionå±æ€§ä¸ºoffset<br>#FileWriter.<strong>truncate(size)</strong> // åœ¨sizeå¤„æˆªæ–­æ–‡ä»¶<br>#FileWriter.abort() // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.readyState // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.error // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.onwritestart // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.onwrite // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.onwriteend // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.onprogress // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.onabort // ç»§æ‰¿è‡ªFileSaver<br>#FileWriter.onerror // ç»§æ‰¿è‡ªFileSaver</pre><br />
<br />
<strong>ä»£ç ç¤ºä¾‹</strong><br />
<br />
ä¸¾ä¾‹ä¸€ï¼šåˆ›å»º<code>Blob</code>å¯¹è±¡<br />
<pre>var blobBuilder = <strong>new BlobBuilder()</strong>; // åˆ›å»ºBlobBuilderå¯¹è±¡<br><strong>blobBuilder.append</strong>("æˆ‘ä»Šå¤©åªè¯´ä¸‰å¥è¯ï¼›"); // è¿ç»­æ”¾å…¥æ–‡æœ¬<br>blobBuilder.append("åŒ…æ‹¬è¿™ä¸€å¥ï¼›");<br>blobBuilder.append("æˆ‘çš„è¯å®Œäº†ã€‚");<br><br>var url = window.URL.createObjectURL(<strong>blobBuilder.getBlob()</strong>); // è¿”å›Blobå¯¹è±¡å¹¶ä»¥æ­¤åˆ›å»ºURL<br>window.open(url); // é€šè¿‡URLæ‰“å¼€è¿™ä¸ªBlobå¯¹è±¡</pre><br />
ä¸¾ä¾‹äºŒï¼šä½¿ç”¨<code>FileWriter</code><br />
<pre>fileEntry.createWriter(function (fileWriter) {<br>    fileWriter.<strong>write</strong>(<strong>blobBuilder.getBlob</strong>()); // è¿”å›Blobå¯¹è±¡å¹¶é€šè¿‡fileWriterå†™å…¥<br>    fileWriter.<strong>onwriteend</strong> = function () {...}; // ç»‘å®šå†™å…¥æ“ä½œå®Œæˆåçš„äº‹ä»¶<br>});</pre><br />
è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br />
1.åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸‹ï¼Œ<code>BlobBuilder</code>å’Œ<code>window.URL</code>ä¾ç„¶å­˜åœ¨ç€ä¸åŒçš„å‰ç¼€ï¼Œæ¯”å¦‚webkitä¸‹çš„æ¥å£åˆ†åˆ«ä¸º<code>WebKitBlobBuilder</code>å’Œ<code>webkitURL</code>ï¼›<br />
2.è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªé™Œç”Ÿçš„å¯¹è±¡<code>fileEntry</code>å’Œé™Œç”Ÿçš„æ–¹æ³•<code>createWriter</code>ï¼Œè¿™æ­£æ˜¯æ¥ä¸‹æ¥è¦ä»‹ç»çš„ä¸€å¥—æ¯”è¾ƒå¤æ‚çš„APIï¼šFileSystemAPIçš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚æƒ³å¼„æ¸…æ¥š<code>fileWriter</code>å…·ä½“è¿è¡Œçš„ç¯å¢ƒï¼Œè¿˜å¾—ç»§ç»­å­¦ä¹ ï¼Œä¸è¿‡æŠ›å¼€å¤–éƒ¨ç¯å¢ƒçš„å½¢æˆè¿‡ç¨‹ï¼Œ<code>fileWriter</code>çš„ç”¨æ³•åº”è¯¥å¯ä»¥ä½“ä¼šåˆ°äº†ï¼›<br />
3.<code>FileSaver</code>è¿˜æ²¡æœ‰ç”¨å¾—åˆ°çš„åœ°æ–¹ï¼Œæ¯•ç«Ÿæ ‡å‡†è¿˜æ²¡æœ‰æœ€ç»ˆå½¢æˆï¼Œä¹Ÿè®¸ä»–å°†æ¥æŸä¸€å¤©ï¼Œå€ŸåŠ©å…¶å®ƒè§„èŒƒçš„ä¼˜åŠ¿ï¼Œæ‘‡èº«ä¸€å˜ï¼Œå°±ç”¨åœ¨â€œå¦å­˜ä¸ºå¯¹è¯æ¡†â€ä¹‹ç±»çš„åœ°æ–¹äº†ã€‚<br />
<br />
ä»¥ä¸Šå°±æ˜¯å¯¹FileWriterAPIçš„ä»‹ç»ï¼Œç´§æ¥ç€å°±æ˜¯FileSystemAPIäº†ï¼Œå±Šæ—¶HTML5æ‰€æœ‰æ–‡ä»¶æ“ä½œçš„ç¥ç§˜é¢çº±éƒ½ä¼šè¢«æ­å¼€ã€‚<br />
<br />
(æœªå®Œå¾…ç»­)</p>

</div>

<p align="right">
  <small>
    <a href="https://github.com/Jinjiang/jinjiang.github.io/edit/dev/source/_posts/2012-03-06.md" target="_blank">
      å‘æœ¬æ–‡æå‡ºä¿®æ”¹æˆ–å‹˜è¯¯å»ºè®®
    </a>
  </small>
</p>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
  const gitalk = new Gitalk({
    clientID: 'c99e23053fc1bba6a58c',
    clientSecret: '64efe1cd1438e77ae2bf8eba92b51c90d0cc2b9f',
    repo: 'jinjiang.github.io',
    owner: 'jinjiang',
    admin: ['jinjiang'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>
</div>

    <div id="footer">
      <a href="/">å›§å…‹æ–¯</a>
      
      |
      <a href="/atom.xml" title="rss_feed">RSS</a>
      
      |
      æˆ‘æ˜¯ç™¾åº¦ç»Ÿè®¡
      <script src="https://hm.baidu.com/h.js?a0a2372d4b7621d0bfe71f33c58a4bd8"></script>
      |
      æˆ‘ä¼šç¿»è„¸ <a href="#" onclick="document.body.classList.toggle('dark-mode'), event.preventDefault()" style="font-size: 1.25em;">ğŸŒšğŸŒ</a>
    </div>
  </div>

  
<script src="/js/script.js"></script>

</body>

</html>
